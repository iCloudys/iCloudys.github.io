<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«ï¼ˆäºŒï¼‰]]></title>
    <url>%2F2017%2F%E7%94%A8Objective-C%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%88%AC%E8%99%AB%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ä¸Šæ¬¡å†™è¿‡çˆ¬è™«çš„åˆç¯‡ï¼Œæˆ‘ä»¬å·²ç»èƒ½çˆ¬åˆ°åŸºæœ¬çš„æ•°æ®äº†ã€‚ä½†æ˜¯ä¸€å¼ ç½‘é¡µçš„æ•°æ®æ˜¯æœ‰é™çš„ï¼Œä»Žæˆ‘ä»¬ä¸Šæ¬¡çš„ç¨‹åºæ¥çœ‹ï¼Œèƒ½æŠ“åˆ°çš„å›¾ç‰‡æ‰ä¸è¿‡åæ¥å¼ ã€‚å¾ˆæ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­å®Œå–„æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæ¥æ»¡è¶³è¿™ä¸ªéœ€æ±‚å§ã€‚ å¿…å¤‡å·¥å…· è”æŽ¥ç½‘ç»œçš„Mac, æµè§ˆå™¨ï¼ŒæŽ¨èç”¨Google Chrome, Xcodeå¼€å‘å·¥å…·, ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«(ä¸€) çš„æºç  å¿…å¤‡æŠ€èƒ½å»ºè®®çœ‹å®Œ ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«(ä¸€) ,æ˜Žç™½ä¸€äº›ç®€å•çš„çŸ¥è¯†,è™½ç„¶æˆ‘å†™çš„å¾ˆçƒ‚,ä½†ä¹Ÿä¸è‡³äºŽçœ‹è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ä¸€å¤´é›¾æ°´ã€‚ æœ¬ç¯‡ç›®æ ‡æ·±åº¦æŠ“å–æ›´å¤šçš„æ•°æ®å¦‚å›¾: åˆ†æžåœ¨ä¸Šç¯‡ä¸­ï¼Œæˆ‘ä»¬ç»™å®šä¸€ä¸ªurlæŠ“å–å®Œå›¾ç‰‡ä¹‹åŽç›´æŽ¥å°±ç»“æŸäº†ï¼Œé‚£ä¹ˆå¦‚ä½•ä¸è®©ç¨‹åºç»“æŸï¼Œè€Œç»§ç»­æŠ“å–åˆ«çš„urå‘¢ï¼Ÿæ€»ä¸èƒ½ç»™SpiderOptionå®šä¹‰ä¸€ä¸ªurlæ•°ç»„,ç¨‹åºçš„è¾“å…¥æ˜¯æœ‰é™çš„,è¿™ç§åŠžæ³•è§£å†³ä¸äº†é—®é¢˜ã€‚èªæ˜Žçš„ä½ ä¸€å®šæƒ³åˆ°äº†ï¼Œåœ¨çˆ¬è™«çˆ¬å–å›¾ç‰‡çš„æ—¶å€™ï¼Œä¸ä¹Ÿæ˜¯å¯ä»¥çˆ¬åˆ°è¿™ä¸ªé¡µé¢çš„è·³è½¬é¡µé¢ä¹ˆï¼Œå¦‚æžœæˆ‘ä»¬åœ¨æŠŠè·³è½¬é¡µé¢çš„å›¾ç‰‡çˆ¬ä¸‹æ¥ï¼Œç”šè‡³æŠŠè·³è½¬é¡µé¢é‡Œé¢çš„è·³è½¬é¡µé¢çˆ¬ä¸‹æ¥ï¼Œè¿™æ ·ä¸€ç›´å¾€æ·±å±‚æ¬¡çš„æŠ“å–æ•°æ®ï¼Œå°±ä¸æ˜¯æºæºä¸æ–­çš„å›¾ç‰‡çˆ¬åˆ°æ‰‹äº†ä¹ˆï¼ŸðŸ˜Žä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹å§ï¼ï¼ï¼ ç¼–ç å‡†å¤‡é¦–å…ˆæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹Spiderç±»ï¼Œç»™Spideræ·»åŠ å‡ ä¸ªå˜é‡:1ã€_finashUrl ç”¨æ¥å­˜æ”¾å·²ç»çˆ¬å–è¿‡çš„url,é˜²æ­¢é‡å¤æŠ“å–,å¯¼è‡´é‡å¤å¾ªçŽ¯ã€‚2ã€_session ç”¨æ¥è¿›è¡ŒèŽ·å–htmlçš„ç½‘ç»œè¯·æ±‚;åœ¨ç¬¬ä¸€ç¯‡ä¸­æˆ‘ä»¬ç›´æŽ¥åœ¨æ–¹æ³•é‡Œé¢å®šä¹‰äº†ç›¸åŒçš„å˜é‡,è¿™é‡Œæˆ‘ä»¬æŠŠå®ƒå£°æ˜Žæˆå˜é‡,é˜²æ­¢é‡å¤åˆ›å»ºå¯¹è±¡.3ã€_urlExpression ç”¨æ¥åŒ¹é…urlçš„æ­£åˆ™è¡¨è¾¾å¼.4ã€_imgExpression ç”¨æ¥åŒ¹é…imgçš„æ­£åˆ™è¡¨è¾¾å¼.5ã€fetchHtmlQueue æ­£åˆ™åŒ¹é…çš„é˜Ÿåˆ—.6ã€operationQueue ç½‘ç»œè¯·æ±‚çš„é˜Ÿåˆ—. å®šä¹‰ä¸Šé¢å˜é‡ä¹‹åŽå¹¶ä¸”åœ¨initæ–¹æ³•ä¸­åˆå§‹åŒ–ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748@interface Spider()&lt;NSURLSessionDataDelegate&gt;@property (nonatomic, strong) NSOperationQueue* fetchHtmlQueue;@property (nonatomic, strong) NSOperationQueue* operationQueue;@end@implementation Spider&#123; //å·²ç»æŠ“å–çš„url NSMutableSet&lt;NSString*&gt;* _finashUrl; NSRegularExpression* _urlExpression; NSRegularExpression* _imgExpression; NSURLSession* _session;&#125;- (instancetype)initWithOption:(SpiderOption *)option&#123; self = [super init]; if (self) &#123; _option = option; _finashUrl = [NSMutableSet set]; _imgExpression = [NSRegularExpression regularExpressionWithPattern:option.pattern options:NSRegularExpressionCaseInsensitive error:nil]; _urlExpression = [NSRegularExpression regularExpressionWithPattern:@"https?:.+?.html" options:NSRegularExpressionCaseInsensitive error:nil]; _operationQueue = [[NSOperationQueue alloc] init]; _operationQueue.maxConcurrentOperationCount = 3; _operationQueue.name = @"com.html.loadQueue"; _fetchHtmlQueue = [[NSOperationQueue alloc] init]; _fetchHtmlQueue.maxConcurrentOperationCount = 3; _fetchHtmlQueue.name = @"com.html.fetchQueue"; NSURLSessionConfiguration* configuration = [NSURLSessionConfiguration defaultSessionConfiguration]; configuration.timeoutIntervalForRequest = 30; _session = [NSURLSession sessionWithConfiguration:configuration delegate:self delegateQueue:_fetchHtmlQueue]; &#125; return self;&#125; æ”¹å†™æ–¹æ³•ç”±äºŽæˆ‘ä»¬ç”¨äº†å¤šçº¿ç¨‹çš„æŠ€æœ¯ï¼Œæ¯æ¬¡åŠ è½½ä¸€ä¸ªurléƒ½è¦æ”¾åˆ°é˜Ÿåˆ—åŽ»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹loadUrlæ–¹æ³•: 12345678910111213141516- (void)loadUrl:(NSURL*)url&#123; WeakSelf; @synchronized(self)&#123; [self-&gt;_operationQueue addOperationWithBlock:^&#123; StrongSelf; NSURLSessionDataTask* task = [sSelf-&gt;_session dataTaskWithURL:url]; [task resume]; &#125;]; &#125;&#125; ä¸Šä¸€æ­¥è¯·æ±‚æˆåŠŸä¹‹åŽï¼Œä¼šè°ƒç”¨sessionçš„ä»£ç†æ–¹æ³•ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦å®žçŽ°sessionçš„ä»£ç†æ–¹æ³•: 1234567891011121314151617181920212223242526272829303132///MARK:- NSURLSessionDataDelegate- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTaskdidReceiveResponse:(NSURLResponse *)response completionHandler:(void (^)(NSURLSessionResponseDisposition))completionHandler&#123; NSURLSessionResponseDisposition disposition = NSURLSessionResponseCancel; NSInteger statusCode = 0; if ([response respondsToSelector:@selector(statusCode)])&#123; statusCode = [((NSHTTPURLResponse*)response) statusCode]; &#125; if (statusCode == 200) &#123; disposition = NSURLSessionResponseAllow; &#125; completionHandler(disposition);&#125;- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveData:(NSData *)data&#123; NSString* html = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; if (html &amp;&amp; html.length &gt; 0) &#123; [self fetchUrlWithHtml:html]; [self fetchImgWithHtml:html]; &#125;&#125; æˆ‘ä»¬åœ¨ä¿®æ”¹ä¸€ä¸‹fetchImgWithHtmlæ–¹æ³•,åŒ¹é…imgä¹Ÿè¦æ”¾åˆ°é˜Ÿåˆ—é‡Œ,åŒ¹é…æˆåŠŸåŽå›žè°ƒå³å¯: 12345678910- (void)fetchImgWithHtml:(NSString*)html&#123; WeakSelf; [self.fetchHtmlQueue addOperationWithBlock:^&#123; StrongSelf; NSArray&lt;NSString*&gt;* strings = [sSelf fetchStringsWithHtml:html expression:sSelf-&gt;_imgExpression]; sSelf.option.complete ? sSelf.option.complete(strings) : nil; &#125;];&#125; åŒç†æˆ‘ä»¬ä¿®æ”¹fetchUrlWithHtmlæ–¹æ³•,å¹¶ä¸”æŠŠéœ€è¦è¯·æ±‚çš„urlæ”¾åˆ°_finashUrlé‡Œé¢,åœ¨è¯·æ±‚ä¹‹å‰åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦è¯·æ±‚è¿‡å³å¯: 123456789101112131415161718- (void)fetchUrlWithHtml:(NSString*)html&#123; WeakSelf; [self.fetchHtmlQueue addOperationWithBlock:^&#123; StrongSelf; NSArray&lt;NSString*&gt;* strings = [sSelf fetchStringsWithHtml:html expression:sSelf-&gt;_urlExpression]; for (NSString* string in strings) &#123; NSURL* url = [NSURL URLWithString:string]; if ([sSelf-&gt;_finashUrl containsObject:string]) &#123; continue; &#125; [sSelf-&gt;_finashUrl addObject:string]; [sSelf loadUrl:url]; &#125; &#125;];&#125; æœ€åŽé™„ä¸ŠfetchStringsWithHtmlæ–¹æ³•: 12345678910111213141516- (NSArray&lt;NSString*&gt;*)fetchStringsWithHtml:(NSString*)html expression:(NSRegularExpression*)expression&#123; NSArray&lt;NSTextCheckingResult*&gt;* results = [expression matchesInString:html options:NSMatchingReportCompletion range:NSMakeRange(0, html.length)]; NSMutableArray&lt;NSString*&gt;* strings = [NSMutableArray arrayWithCapacity:results.count]; for (NSTextCheckingResult* result in results) &#123; NSString* sub = [html substringWithRange:result.range]; [strings addObject:sub]; &#125; return strings;&#125; è¿è¡ŒæŽ¥ä¸‹æ¥è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ç¨‹åºä¸åœçš„æŠ“å–å›¾ç‰‡ï¼Œè¶Šæ¥è¶Šå¤šã€‚ å¯è§†åŒ–ä¸ºäº†æ›´å¥½çš„æµè§ˆæˆ‘ä»¬èŽ·å–çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æŽ§åˆ¶å™¨é‡Œé¢ç”¨UICollectionViewå±•çŽ°å‡ºæ¥ï¼Œç›´æŽ¥ä¸Šä»£ç : 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788- (void)appendUrls:(NSArray&lt;NSString *&gt;*)urls&#123; if (urls.count &gt; 0) &#123; WeakSelf; dispatch_async(dispatch_get_main_queue(), ^&#123; [self.collectionView performBatchUpdates:^&#123; NSMutableArray&lt;NSIndexPath*&gt;* idxs = [NSMutableArray array]; for (int i = 0; i &lt; urls.count; i ++) &#123; NSIndexPath* idx = [NSIndexPath indexPathForItem:weakSelf.urls.count + i inSection:0]; [idxs addObject:idx]; &#125; [weakSelf.urls addObjectsFromArray:urls]; [weakSelf.collectionView insertItemsAtIndexPaths:idxs]; &#125; completion: NULL]; &#125;); &#125;&#125;- (void)viewDidLayoutSubviews&#123; [super viewDidLayoutSubviews]; self.collectionView.frame = self.view.bounds;&#125;- (NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section&#123; return self.urls.count;&#125;- (__kindof UICollectionViewCell*)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath&#123; CollectionViewCell* cell = [collectionView dequeueReusableCellWithReuseIdentifier:CollectionViewCellID forIndexPath:indexPath]; cell.url = self.urls[indexPath.row]; return cell;&#125;- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout minimumLineSpacingForSectionAtIndex:(NSInteger)section&#123; return 0.5;&#125;- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout minimumInteritemSpacingForSectionAtIndex:(NSInteger)section&#123; return 0.01;&#125;- (UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout insetForSectionAtIndex:(NSInteger)section&#123; return UIEdgeInsetsZero;&#125;- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath&#123; UICollectionViewFlowLayout* layout = (UICollectionViewFlowLayout*)collectionViewLayout; CGFloat w = (CGRectGetWidth(collectionView.frame) - layout.minimumInteritemSpacing - layout.sectionInset.left - layout.sectionInset.right) / 8 - 0.5; return CGSizeMake(w, w);&#125;- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath&#123; DetailController* detail = [[DetailController alloc] init]; detail.url = self.urls[indexPath.row]; [self.navigationController pushViewController:detail animated:YES];&#125;- (UICollectionView *)collectionView&#123; if (!_collectionView) &#123; UICollectionViewFlowLayout* layout = [[UICollectionViewFlowLayout alloc] init]; layout.minimumLineSpacing = 0.5; layout.minimumInteritemSpacing = 0; layout.sectionInset = UIEdgeInsetsZero; _collectionView = [[UICollectionView alloc] initWithFrame:CGRectZero collectionViewLayout:layout]; _collectionView.delegate = self; _collectionView.dataSource = self; [_collectionView registerClass:[CollectionViewCell class] forCellWithReuseIdentifier:CollectionViewCellID]; _collectionView.backgroundColor = [UIColor whiteColor]; &#125; return _collectionView;&#125; è‡³æ­¤ï¼Œæˆ‘ä»¬å°±ç®—å®Œæˆäº†æˆ‘ä»¬çš„ç›®æ ‡;çœ‹åˆ°ç¨‹åºä¸åœçš„æœ‰å›¾ç‰‡åŠ è½½å‡ºæ¥ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹å°å…´å¥‹å‘¢ã€‚ðŸ˜„çŽ°åœ¨æˆ‘ä»¬å†™çš„ç¨‹åºä¼šæ— é™å¾ªçŽ¯çš„çˆ¬å–ï¼Œä½†æ˜¯æ€Žä¹ˆèƒ½æŽ§åˆ¶çˆ¬å–æ·±åº¦å‘¢ï¼Ÿ æŽ§åˆ¶æ·±åº¦æˆ‘çš„åšæ³•æ˜¯ç»™urlåˆ›å»ºä¸€ä¸ªåˆ†ç±»ï¼Œæ·»åŠ ä¸€ä¸ªå±žæ€§depthè¡¨ç¤ºæ­¤urlçš„æ·±åº¦å€¼,åˆå§‹çš„urlæ·±åº¦ä¸º0,åœ¨æ­¤é¡µé¢ä¸Šçˆ¬å–çš„urlæ·±åº¦ä¸º1ï¼Œè¿™æ ·ä»¥æ­¤ç±»æŽ¨ï¼Œç›´åˆ°æˆ‘ä»¬æŒ‡å®šæ·±åº¦åœæ­¢ä¸ºæ­¢ã€‚ NSURL+depth.h 12345@interface NSURL (depth)@property (nonatomic, assign) NSUInteger depth;@end NSURL+depth.m 1234567891011121314151617#import "NSURL+depth.h"#import &lt;objc/runtime.h&gt;static const void * depth_key = "depth_key";@implementation NSURL (depth)@dynamic depth;- (NSUInteger)depth&#123; return [objc_getAssociatedObject(self, depth_key) unsignedIntegerValue];&#125;- (void)setDepth:(NSUInteger)depth&#123; objc_setAssociatedObject(self, depth_key, @(depth), OBJC_ASSOCIATION_ASSIGN);&#125;@end ç„¶åŽåœ¨æˆ‘ä»¬çš„ startæ–¹æ³•é‡Œé¢ç»™ç¬¬ä¸€ä¸ªurlçš„æ·±åº¦èµ‹å€¼: 123456- (void)start&#123; NSURL* url = [NSURL URLWithString:self.option.website]; url.depth = 0; [self loadUrl:url];&#125; åœ¨sessionå›žè°ƒçš„æ–¹æ³•é‡Œé¢æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸‹æ­¤urlçš„æ·±åº¦æ˜¯å¦éœ€è¦ç»§ç»­çˆ¬å–: 12345678910111213- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveData:(NSData *)data&#123; NSString* html = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; NSUInteger depth = dataTask.originalRequest.URL.depth; if (html &amp;&amp; html.length &gt; 0) &#123; if (depth &lt; self.option.maxDepth) &#123; [self fetchUrlWithHtml:html depth:depth + 1]; &#125; [self fetchImgWithHtml:html]; &#125;&#125; ç„¶åŽæ”¹ä¸‹fetchUrlWithHtmlæ–¹æ³•ï¼Œç»™ä¸‹ä¸ªurlèµ‹å€¼æ·±åº¦: 12345678910111213141516171819202122232425262728- (void)fetchUrlWithHtml:(NSString*)html depth:(NSUInteger)depth&#123; WeakSelf; [self.fetchHtmlQueue addOperationWithBlock:^&#123; StrongSelf; NSArray&lt;NSString*&gt;* strings = [sSelf fetchStringsWithHtml:html expression:sSelf-&gt;_urlExpression]; for (NSString* string in strings) &#123; NSURL* url = [NSURL URLWithString:string]; if ([sSelf-&gt;_finashUrl containsObject:string]) &#123; continue; &#125; url.depth = depth; [sSelf-&gt;_finashUrl addObject:string]; [sSelf loadUrl:url]; &#125; &#125;];&#125;``` æœ€åŽå¿˜è¯´äº†ä¸€ä¸ªåœ°æ–¹,é‚£å°±æ˜¯`SpiderOption`,ç»™è¿™ä¸ªç±»æ·»åŠ ä¸€ä¸ªæœ€å¤§æ·±åº¦çš„å±žæ€§,è®©å¤–ç•Œæ¥æŽ§åˆ¶: ```objc /** æœ€å¤§æŠ“å–æ·±åº¦ é»˜è®¤ NSUIntegerMax */@property (nonatomic, assign) NSUInteger maxDepth; ok,åœ¨æŽ§åˆ¶å™¨é‡Œé¢ç»™å®šæœ€å¤§çš„æ·±åº¦,æœ€å¥½ä¸è¦å¤ªå¤§,è¿è¡Œä¸€ä¸‹å§ï¼ï¼ï¼ ç›¸å…³é“¾æŽ¥: é¡¹ç›®æºç  ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«(ä¸€)]]></content>
  </entry>
  <entry>
    <title><![CDATA[ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2017%2F%E7%94%A8Objective-C%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%88%AC%E8%99%AB%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ä½ æ˜¯ä¸æ˜¯æƒ³å†™ä¸ªçˆ¬è™«æ¥æŠ“å–ç‚¹ä¸œè¥¿,ä½†æ˜¯ä½ åˆä¸ä¼šPythonæˆ–è€…åˆ«çš„è¯­è¨€ï¼Œé‚£ä¹ˆä½ å°±å¾—æ„Ÿè°¢ä½ è‡ªå·±èƒ½æ¥åˆ°è¿™é‡Œã€‚æŽ¥ä¸‹æ¥å°±äº¤ç»™ä½ å¦‚ä½•ç”¨Objective-Cå†™ä¸€ä¸ªçˆ¬è™«ã€‚ ä»€ä¹ˆï¼ŸObjective-Cä¹Ÿèƒ½å†™çˆ¬è™«ï¼Ÿä¸éƒ½æ˜¯Pythonæ‰å¯ä»¥çš„ä¹ˆï¼Ÿé‚£ä¹ˆæˆ‘å‘Šè¯‰ä½ åŸºæœ¬ä¸Šå¤§éƒ¨åˆ†è¯­è¨€éƒ½æ˜¯å¯ä»¥å†™çˆ¬è™«çš„ï¼Œåªæ˜¯Pythonç”¨æ¥å†™çˆ¬è™«æ¯”è¾ƒæ–¹ä¾¿ï¼Œä»–æœ‰æµ·é‡çš„ä¸‰æ–¹åº“å¯ä»¥è®©å¼€å‘è€…è°ƒç”¨è€Œå·²ã€‚è€Œåˆ«çš„è¯­è¨€åŸºæœ¬ä¸Šå°±æ˜¯é è‡ªå·±è‹¦é€¼çš„æ’¸äº†ã€‚ é‚£ä¹ˆç”¨Objective-Cå†™çˆ¬è™«æœ‰ä»€ä¹ˆç”¨ï¼Ÿé iPhoneæ¥çˆ¬æ•°æ®ä¹ˆï¼Ÿè¿™é‡Œåšä¸»åªæ˜¯å†™ä¸ªç®€å•çš„çˆ¬è™«è€Œå·²ï¼Œå¹¶ä¸æŒ‡æœ›ç”¨æ­¤æ¥ä¸“é—¨æŠ“å–æ•°æ®ï¼Œä½ è§‰å¾—è®©æ‰‹æœºåŽ»çˆ¬æ•°æ®èƒ½çˆ¬å¤šå°‘å•Šã€‚æœ¬æ•™ç¨‹ä¼šå…¼å®¹Macè½¯ä»¶å¼€å‘ï¼Œä½ å¯ä»¥ç”¨æ­¤æŠ€æœ¯å¼€å‘macçˆ¬è™«å·¥å…·ã€‚ åºŸè¯å°‘è¯´ï¼Œè®©æˆ‘ä»¬æ¥å¼€å§‹å§ï¼ å¿…å¤‡å·¥å…· é“¾æŽ¥ç½‘ç»œçš„Mac, æµè§ˆå™¨ï¼ŒæŽ¨èç”¨Google Chrome Xcodeå¼€å‘å·¥å…· å¿…å¤‡æŠ€èƒ½ ç†Ÿæ‚‰Objective-C èƒ½é˜…è¯»HTML,èƒ½è®¤è¯†åŸºæœ¬çš„æ ‡ç­¾å³å¯ æ­£åˆ™è¡¨è¾¾å¼,å¤§æ¦‚æµè§ˆä¸€ä¸‹å°±è¡Œ,è¿™é‡Œåœ¨é‡åˆ°çš„æ—¶å€™åšä¸»ä¼šç®€å•ä»‹ç»ä¸€ä¸‹ æœ¬ç¯‡ç›®æ ‡ æŠ“å–å›žè½¦æ¡Œé¢ä¸Šçš„å›¾ç‰‡ é™„å›¾: åˆ†æžç½‘é¡µç”¨æµè§ˆå™¨æ‰“å¼€å›žè½¦æ¡Œé¢,å¹¶ä¸”æŒ‰ä¸‹ option + command + iæ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚å¦‚å›¾: ç¡®ä¿å³ä¸Šæ–¹æ˜¯é€‰ä¸­çš„Elementsé€‰é¡¹ï¼Œä¸‹é¢HTMLå°±æ˜¯ç½‘é¡µçš„æºä»£ç ã€‚é¼ æ ‡åœ¨HTMLä¸Šé¢ç§»åŠ¨çš„æ—¶å€™å·¦ä¾§é¡µé¢ä¼šæœ‰ç›¸åº”çš„æ¨¡å—æç¤ºï¼Œæˆ‘ä»¬ä»¥æ¬¡ç‚¹å¼€æ ‡ç­¾ï¼Œå°±èƒ½æ‰¾åˆ°æƒ³è¦çš„å›¾ç‰‡åœ°å€: å¦‚å›¾: ç²˜ä¸€æ®µä»£ç : 123456&lt;img a_width="576" a_height="360" src="https://up.enterdesk.com/edpic_360_360/cf/e1/8f/cfe18f5a7e0a42355784bb992f313853.jpg" alt="æ¸…æ˜ŽèŠ‚æ°”" title="æ¸…æ˜ŽèŠ‚æ°”" style="height: 185px; width: 296px;"&gt; ä¸Šæ®µä»£ç ä¸­srcå°±æ˜¯ç½‘é¡µä¸­çš„å›¾ç‰‡åœ°å€ï¼Œæˆ‘ä»¬æŽ¥ä¸‹æ¥å°±æ˜¯æŠŠè¿™ä¸ªsrcçš„å€¼æå–å‡ºæ¥ã€‚ ç¼–ç ä¸Šé¢æˆ‘ä»¬åˆ†æžäº†ç½‘é¡µæºç ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¤§è‡´æµç¨‹ï¼š èŽ·å–ç½‘é¡µæºç  æ­£åˆ™æå–url å¥½! è®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªObjective-Cé¡¹ç›®ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦æ˜¯æ¥ä»‹ç»å¦‚ä½•å†™çˆ¬è™«ï¼Œè‡³äºŽObjective-Cé¡¹ç›®è‡ªå·±åˆ›å»ºå³å¯ã€‚ åˆå§‹åŒ–åšä¸»è¿™é‡Œåœ¨ä¸»æŽ§åˆ¶å™¨ä¸Šé¢æ·»åŠ ä¸€ä¸ªUITextViewï¼ŒèƒŒæ™¯è‰²ä¸ºé»‘è‰²ï¼›Tint é¢œè‰²ä¸ºç»¿è‰²ï¼Œ(è¿™æ ·çš„é¢œè‰²çœ‹èµ·æ¥æ¯”è¾ƒé«˜å¤§ä¸Šä¸€ç‚¹)ï¼›ä¸å¯ç¼–è¾‘ï¼›æ‰“å¼€è¶…è¿žæŽ¥åŠŸèƒ½ï¼›å¹¶ä¸”è¿žæŽ¥åˆ°æ‰€åœ¨çš„æŽ§åˆ¶å™¨ã€‚å¦‚å›¾: åˆ›å»ºå·¥å…·ç±»åˆ›å»ºSpiderç±»å’ŒSpiderOptionç±»ã€‚Spideræ˜¯çˆ¬è™«å·¥å…·ç±»;SpiderOptionæ˜¯å‚æ•°ç±»ï¼Œåœ¨çˆ¬æ•°æ®è¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„å‚æ•°éƒ½ç”±SpiderOptionä¼ é€’ç»™Spider SpiderOption.h 12345678910111213141516171819202122#import &lt;Foundation/Foundation.h&gt;typedef void(^SpiderCompleteHander)(NSString* url);@interface SpiderOption : NSObject/** ç›®æ ‡ç½‘ç«™ */@property (nonatomic, copy) NSString* website;/** æŠ“å–æ•°æ®æ­£åˆ™è¡¨è¾¾å¼ */@property (nonatomic, copy) NSString* pattern;/** UrlæŠ“å–å®Œæˆå›žè°ƒ */@property (nonatomic, copy) SpiderCompleteHander progress;@end Spider.h 123456789101112131415161718192021222324#import &lt;Foundation/Foundation.h&gt;#import "SpiderOption.h"@interface Spider : NSObject/** å‚æ•°ç±» */@property (nonatomic, strong, readonly) SpiderOption* option;/** åˆå§‹åŒ–æ–¹æ³• @param option å‚æ•°ç±» @return self */- (instancetype)initWithOption:(SpiderOption*)option;/** å¼€å§‹æŠ“å– */- (void)start;@end Spider.m 1234567891011121314151617#import "Spider.h"@implementation Spider- (instancetype)initWithOption:(SpiderOption *)option&#123; self = [super init]; if (self) &#123; _option = option; &#125; return self;&#125;- (void)start&#123;&#125;@end æµ‹è¯•å·¥å…·ç±»ç»è¿‡ç¬¬äºŒæ­¥ä¹‹åŽï¼Œåˆæ­¥çš„çˆ¬è™«å·¥å…·å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œä¸‹é¢æˆ‘ä»¬åœ¨ViewController.mé‡Œé¢è°ƒç”¨æˆ‘ä»¬çš„çˆ¬è™«å·¥å…·ã€‚ ViewController.m 123456789101112131415161718192021222324252627282930313233343536373839404142#import "ViewController.h"#import "Spider.h"@interface ViewController ()@property (weak, nonatomic) IBOutlet UITextView *textView;@property (strong, nonatomic) Spider *spider;@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; //åˆå§‹åŒ–ä¸€ä¸ªå‚æ•°ç±» SpiderOption* option = [[SpiderOption alloc] init]; //å‡†å¤‡ç›®æ ‡ç½‘å€ option.website = @"https://www.enterdesk.com"; //å¤„ç†å›žè°ƒï¼Œå½“æˆåŠŸæŠ“å–ä¸€ä¸ªå†…å®¹ä¹‹åŽï¼Œæˆ‘ä»¬å°±æŠŠä»–æ‹¼æŽ¥åˆ°textViewçš„åº•éƒ¨ option.complete = ^(NSString *url) &#123; [self showLogs:url]; &#125;; //åˆå§‹åŒ–çˆ¬è™«ç±» self.spider = [[Spider alloc] initWithOption:option]; //å¼€å§‹æŠ“å– [self.spider start];&#125;- (void)showLogs:(NSString*)log&#123; //æŠŠLogå†…å®¹æ‹¼æŽ¥åˆ°textViewæœ€ä¸‹é¢ï¼Œå¹¶ä¸”æ»šåŠ¨åˆ°æœ€ä¸‹é¢ if (log.length &gt; 0) &#123; [self.textView insertText:[NSString stringWithFormat:@"%@\n\n",log]]; [self.textView scrollRangeToVisible:NSMakeRange(self.textView.text.length, 0)]; &#125;&#125;@end çŽ°åœ¨æ¥è¿è¡Œä¸€ä¸‹æˆ‘ä»¬çš„é¡¹ç›®ï¼Œè™½ç„¶ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¼€å§‹çˆ¬ä»€ä¹ˆæ•°æ®ï¼ŒæŽ¥ä¸‹è®©æˆ‘ä»¬æ¥å®Œå–„æˆ‘ä»¬çš„Spiderå·¥å…·ç±»ã€‚ å®Œå–„å·¥å…·ç±»åœ¨æˆ‘ä»¬çš„Spider.mé‡Œé¢æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥èŽ·å–ç½‘é¡µçš„HTMLæºç ï¼š 12345678910111213141516171819- (void)loadUrl:(NSString*)urlString&#123; WeakSelf; urlString = [urlString stringByAddingPercentEncodingWithAllowedCharacters:[NSCharacterSet URLQueryAllowedCharacterSet]]; NSURL* url = [NSURL URLWithString:urlString]; NSURLSessionConfiguration* configuration = [NSURLSessionConfiguration defaultSessionConfiguration]; NSURLSession* session = [NSURLSession sessionWithConfiguration:configuration]; NSURLSessionDataTask* task = [session dataTaskWithURL:url completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123; if (!error) &#123; NSString* html = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; NSLog(@"%@",html); &#125; &#125;]; [task resume];&#125; æŽ¥ä¸‹æ¥åœ¨æˆ‘ä»¬çš„startæ–¹æ³•è°ƒç”¨ä¸Šè¿°æ–¹æ³•: 123- (void)start&#123; [self loadUrl:self.option.website];&#125; è®©æˆ‘ä»¬åœ¨è¿è¡Œä¸€æ¬¡é¡¹ç›®ï¼Œå¦‚æžœç½‘ç»œæ²¡æœ‰é—®é¢˜çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°æŽ§åˆ¶å™¨ä¸Šé¢è¾“å‡ºçš„HTMLæºç ,å°½ç®¡æˆ‘ä»¬çš„textViewè¿˜æ˜¯é»‘é»‘çš„ä¸€ç‰‡ã€‚å¦‚ä¸‹å›¾: æ­£åˆ™åŒ¹é…æˆ‘ä»¬å†æ¬¡ç»™Spider.mæ·»åŠ ä¸€ä¸ªæ–¹æ³•,è¿™ä¸ªæ–¹æ³•ä¸»è¦å°±æ˜¯ä»ŽHTMLé‡Œé¢æå–å‡ºæˆ‘ä»¬æƒ³è¦çš„å†…å®¹ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„å›¾ç‰‡,ç„¶åŽå›žè°ƒç»™æŽ§åˆ¶å™¨: 123456789101112131415161718192021- (void)matchesStringInHtml:(NSString*)html&#123; WeakSelf; NSRegularExpression* expression = [NSRegularExpression regularExpressionWithPattern:self.option.pattern options:NSRegularExpressionCaseInsensitive error:nil]; NSArray&lt;NSTextCheckingResult*&gt;* results = [expression matchesInString:html options:NSMatchingReportCompletion range:NSMakeRange(0, html.length)]; NSMutableArray&lt;NSString*&gt;* strings = [NSMutableArray arrayWithCapacity:results.count]; for (NSTextCheckingResult* result in results) &#123; NSString* sub = [html substringWithRange:result.range]; [strings addObject:sub]; &#125; weakSelf.option.progress ? weakSelf.option.progress(strings) : nil;&#125; æ–¹æ³•å†™å¥½äº†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨loadUrlçš„completionHandlerè°ƒç”¨ä¸€ä¸‹. 123456789 Â·Â·Â· NSString* html = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; if (!error &amp;&amp; html.length &gt; 0) &#123; [sSelf fetchImgWithHtml:html]; &#125;else&#123; NSLog(@"åŠ è½½å‡ºé”™:%@",error); &#125; Â·Â·Â· è¿˜éœ€è¦ç»™SpiderOptionçš„patternèµ‹å€¼ï¼Œé‚£æˆ‘ä»¬åœ¨ViewController.mé‡Œé¢æ·»åŠ ä»¥ä¸‹æ­£åˆ™å³å¯ï¼š 123456...option.website = @"https://www.enterdesk.com";option.pattern = @"(?&lt;=(src=\"))https?://.+?.(jpg|png)";... æœ€åŽï¼Œè®©æˆ‘ä»¬è¿è¡Œä»¥ä¸‹çœ‹æ•ˆæžœå§,æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘€ï¼ï¼ï¼ å¤‡æ³¨æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹æ­£åˆ™(?&lt;=(src=\&quot;))https?://.+?.(jpg|png)è¡¨è¾¾å¼çš„å«ä¹‰: HTMLä¸­çš„å›¾ç‰‡åœ°å€å¯èƒ½ç±»ä¼¼äºŽhttp://aaa.jpgã€åˆæˆ–è€…æ˜¯ä»¥httpså¼€å¤´çš„https://aaa.jpg,é‚£æˆ‘ä»¬å°±ç”¨https?://aaa.jpgå³å¯åŒ¹é…httpä¹Ÿå¯åŒ¹é…httpsã€‚?åœ¨è¿™é‡Œè¡¨ç¤ºå‰ä¸€ä¸ªå­—ç¬¦sæœ‰0ä¸ªæˆ–è€…1ä¸ªã€‚ æˆ–è®¸ç½‘é¡µä¸­çš„å›¾ç‰‡ä¸ä»…ä»…æ˜¯.jpgåˆæˆ–è€…æ˜¯.pngã€.gifç­‰ç­‰ï¼Œæˆ‘ä»¬ç”¨æˆ–|æå–æˆ‘ä»¬æƒ³è¦çš„æ ¼å¼å›¾ç‰‡ã€‚æ¯”å¦‚.(jpg|png)å°±æ˜¯æˆ‘ä»¬æƒ³å–jpgæˆ–è€…æ˜¯pngçš„å›¾ç‰‡,å¦‚æžœä½ ä¹Ÿæƒ³æå–.gifçš„å›¾ç‰‡ï¼Œå¯ä»¥è¿™æ ·å†™.(jpg|png|gif)å³å¯ã€‚ æˆ‘ä»¬å†è¯´è¯´ä¸­é—´çš„.+?,.ä»£è¡¨å•ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼è¿™æ ·å†™http://..jpgæˆ‘ä»¬åªèƒ½æå–http://a.jpgè¿™ä¸­é—´åªæœ‰å•ä¸ªå­—ç¬¦çš„urlã€‚é‚£å¦‚æžœæˆ‘ä»¬æƒ³æå–ä¸­é—´ä¸ªæ•°ä¸ç¡®å®šçš„å‘¢ï¼Ÿæ¯”å¦‚http://abc.jpg?æˆ‘ä»¬å°±åœ¨.åŽé¢åŠ ä¸ª+å³å¯ï¼›+è¡¨ç¤ºå¤§äºŽç­‰äºŽ1ä¸ªï¼Œæ¯”å¦‚http://.+.jpgæˆ‘ä»¬æ—¢å¯ä»¥åŒ¹é…åˆ°http://a.jpgä¹Ÿå¯åŒ¹é…åˆ°http://aaa.jpgç­‰ä¸­é—´å¤šä¸ªå­—ç¬¦çš„urlã€‚ é‚£ä¹ˆåŽé¢çš„?å‘¢,è¿™é‡Œçš„?å¤šä»£è¡¨çš„æ˜¯éžè´ªå©ªåŒ¹é…ï¼Œä¸¾ä¸ªä¾‹å­:http://aa.jpg.jpgåƒè¿™ç§urlæˆ‘ä»¬è¯¥æ€Žä¹ˆæå–å‘¢ï¼Œå¦‚æžœæŒ‰ç…§åˆšæ‰http://.+.jpgçš„è¡¨è¾¾å¼åŒ¹é…å‡ºæ¥çš„æ˜¯http://aa.jpg.jpgæ•´ä¸ªä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬åªæƒ³æå–åˆ°http://aa.jpgæ€Žä¹ˆåŠžï¼Œæˆ‘ä»¬å°±åœ¨+åŽé¢åŠ ä¸ª?ä»£è¡¨å°½å¯èƒ½å°‘çš„åŒ¹é…ï¼Œå°±æ˜¯æ‰€è°“çš„éžè´ªå©ªåŒ¹é…ã€‚ æœ€åŽåœ¨è¯´ä¸€ä¸‹(?&lt;=(src=\&quot;))è¿™ä¸ªæ„æ€å°±æ˜¯æˆ‘ä»¬è¦æå–src=&quot;åŽé¢çš„http:xx.jpgçš„å›¾ç‰‡ï¼Œä½†æ˜¯ä¸åŒ…å«src=&quot;ã€‚ä¸¾ä¸ªðŸŒ°:å¦‚æžœæŠŠè¿™ä¸ªè¡¨è¾¾å¼åŽ»æŽ‰ï¼Œæˆ‘ä»¬ä¼šå‘çŽ°æå–åˆ°çš„urlæœ‰å¯èƒ½æ˜¯è¿™æ ·https://www.enterdesk.com/bizhi/5488.html\&quot;&gt;&lt;img src=\&quot;https://up.enterdesk.com/edpic_360_360/34/3f/f4/343ff4ada1548da0a81388f86dd9d1af.jpgï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æžœã€‚æ‰€ä»¥è¯´è¿™ä¸ªå°±æ˜¯èµ·åˆ°äº†ç›¸åº”çš„ä½œç”¨ã€‚ ç›¸å…³é“¾æŽ¥: é¡¹ç›®æºç  ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«(äºŒ)]]></content>
  </entry>
  <entry>
    <title><![CDATA[æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢]]></title>
    <url>%2F2017%2F%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[æ˜¥æ±ŸèŠ±æœˆå¤œ ã€ä½œè€…ã€‘å¼ è‹¥è™š ã€æœä»£ã€‘å” è¯‘æ–‡å¯¹ç…§ æ˜¥æ±Ÿæ½®æ°´è¿žæµ·å¹³ï¼Œæµ·ä¸Šæ˜Žæœˆå…±æ½®ç”Ÿã€‚æ»Ÿæ»Ÿéšæ³¢åƒä¸‡é‡Œï¼Œä½•å¤„æ˜¥æ±Ÿæ— æœˆæ˜Žï¼ æ±Ÿæµå®›è½¬ç»•èŠ³ç”¸ï¼Œæœˆç…§èŠ±æž—çš†ä¼¼éœ°ï¼›ç©ºé‡Œæµéœœä¸è§‰é£žï¼Œæ±€ä¸Šç™½æ²™çœ‹ä¸è§ã€‚ æ±Ÿå¤©ä¸€è‰²æ— çº¤å°˜ï¼ŒçšŽçšŽç©ºä¸­å­¤æœˆè½®ã€‚æ±Ÿç•”ä½•äººåˆè§æœˆï¼Ÿæ±Ÿæœˆä½•å¹´åˆç…§äººï¼Ÿ äººç”Ÿä»£ä»£æ— ç©·å·²ï¼Œæ±Ÿæœˆå¹´å¹´åªç›¸ä¼¼ã€‚ä¸çŸ¥æ±Ÿæœˆå¾…ä½•äººï¼Œä½†è§é•¿æ±Ÿé€æµæ°´ã€‚ ç™½äº‘ä¸€ç‰‡åŽ»æ‚ æ‚ ï¼Œé’æž«æµ¦ä¸Šä¸èƒœæ„ã€‚è°å®¶ä»Šå¤œæ‰èˆŸå­ï¼Ÿä½•å¤„ç›¸æ€æ˜Žæœˆæ¥¼ï¼Ÿ å¯æ€œæ¥¼ä¸Šæœˆå¾˜å¾Šï¼Œåº”ç…§ç¦»äººå¦†é•œå°ã€‚çŽ‰æˆ·å¸˜ä¸­å·ä¸åŽ»ï¼Œæ£è¡£ç §ä¸Šæ‹‚è¿˜æ¥ã€‚ æ­¤æ—¶ç›¸æœ›ä¸ç›¸é—»ï¼Œæ„¿é€æœˆåŽæµç…§å›ã€‚é¸¿é›é•¿é£žå…‰ä¸åº¦ï¼Œé±¼é¾™æ½œè·ƒæ°´æˆæ–‡ã€‚ æ˜¨å¤œé—²æ½­æ¢¦è½èŠ±ï¼Œå¯æ€œæ˜¥åŠä¸è¿˜å®¶ã€‚æ±Ÿæ°´æµæ˜¥åŽ»æ¬²å°½ï¼Œæ±Ÿæ½­è½æœˆå¤è¥¿æ–œã€‚ æ–œæœˆæ²‰æ²‰è—æµ·é›¾ï¼Œç¢£çŸ³æ½‡æ¹˜æ— é™è·¯ã€‚ä¸çŸ¥ä¹˜æœˆå‡ äººå½’ï¼Œè½æœˆæ‘‡æƒ…æ»¡æ±Ÿæ ‘ã€‚ 12345@interface Dog- (void)viewDidLoad()&#123; NSLog(@"Hello world");&#125;@end 12345class Dog&#123; public static void main(String[] args)&#123; System.out.println("Hello world"); &#125;&#125; ä»…æ­¤çºªå¿µéƒ¨ç½²çš„ç¬¬ä¸€ä¸ªåšå®¢ï¼Œ ç‰¹åˆ«æ„Ÿè°¢:Devin_ tag { color:#999999 } author { font-size:14px }]]></content>
  </entry>
</search>
