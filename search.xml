<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[å°ç¨‹åºéšè—canvasçš„å‘]]></title>
    <url>%2F2018%2F%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%9A%90%E8%97%8Fcanvas%E7%9A%84%E5%9D%91%2F</url>
    <content type="text"><![CDATA[éœ€æ±‚ä»Šå¤©æ”¶åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œå†…å®¹æ˜¯åœ¨å¾®ä¿¡å°ç¨‹åºç‚¹å‡»æŒ‰é’®åŽï¼Œå¼¹å‡ºä¸€ä¸ªåŠ¨æ€ç”Ÿæˆçš„å›¾ç‰‡ï¼Œå¹¶ä¸”ä¿å­˜åœ¨ç³»ç»Ÿç›¸å†Œé‡Œé¢ã€‚åœ¨å®žçŽ°è¿‡ç¨‹ä¸­é‡åˆ°ä¸€äº›å‘ï¼Œè®°å½•ä¸€ä¸‹ã€‚ CanvasåŠ¨æ€ç”Ÿæˆå›¾ç‰‡ç¬¬ä¸€æ­¥å…ˆåœ¨æ™®é€šé¡µé¢å®žçŽ°åŠ¨æ€ç”Ÿæˆå›¾ç‰‡çš„åŠŸèƒ½ï¼Œå…ˆä¸è€ƒè™‘éšè—ç­‰åŠŸèƒ½ã€‚ä»£ç å¦‚ä¸‹:wxml: 12345&lt;canvas canvas-id=&quot;shareCanvas&quot; style=&quot;width:&#123;&#123;canvasWidth&#125;&#125;px;height:&#123;&#123;canvasWidth*1.5&#125;&#125;px&quot;&gt;&lt;/canvas&gt;``` `JS:` var canvas = wx.createCanvasContext(â€˜shareCanvasâ€™) canvas.drawImage(â€˜../../image/share-img.pngâ€™,0,0,this.data.canvasWidth,this.data.canvasWidth * 1.5) canvas.setTextAlign(â€˜centerâ€™)canvas.setFillStyle(â€˜#ffffffâ€™)canvas.setFontSize(12)canvas.fillText(â€œç”Ÿæˆçš„æ–‡å­—â€, this.data.canvasWidth 0.5, this.data.canvasWidth 1.26) canvas.stroke();canvas.draw() wx.canvasToTempFilePath({ canvasId: â€˜shareCanvasâ€™, success: function(res) { wx.saveImageToPhotosAlbum({ filePath: res.tempFilePath, success: function(res) { console.log(res) }, fail: function(err) { console.log(err) } }) }})12345678910ä»¥ä¸Šjsä»£ç å°±æ˜¯èŽ·å–`canvas`æŽ§ä»¶ï¼Œå¡«å……ä¸€å¼ å›¾åšèƒŒæ™¯ï¼Œç„¶åŽç”Ÿæˆæ–‡å­—ã€‚ ç„¶åŽ`canvas`ç”Ÿæˆå›¾ç‰‡ï¼Œåœ¨æˆåŠŸå›žè°ƒæ–¹æ³•é‡Œé¢ä¿å­˜åˆ°ç›¸å†Œé‡Œé¢ã€‚ ä»¥ä¸Šä»£ç åœ¨æ­£å¸¸é¡µé¢å†…æ‰§è¡Œæ²¡é—®é¢˜ã€‚### Canvasåœ¨è‡ªå®šä¹‰ç»„ä»¶å†… å®Œæˆäº†ç¬¬ä¸€æ­¥åŽï¼Œè€ƒè™‘åˆ°è¿™ä¸ªæŒ‰é’®å¯èƒ½åœ¨ä¸åŒçš„é¡µé¢ã€‚å°±å•ç‹¬æŠŠä¸Šé¢çš„åŠŸèƒ½å°è£…æˆä¸€ä¸ªç»„ä»¶ã€‚ åœ¨æ™®é€šé¡µé¢å¼•å…¥ç»„ä»¶åŽï¼ŒæŠ¥é”™`&quot;canvasToTempFilePath: fail canvas is empty&quot;`,æŸ¥é˜…æ–‡æ¡£åŽï¼Œå‘çŽ°`createCanvasContext``canvasToTempFilePath``saveImageToPhotosAlbum`è¿™ä¸‰ä¸ªæ–¹æ³•éœ€è¦ä¼ `this`è¿™ä¸ªå‚æ•°ã€‚`JS`: var canvas = wx.createCanvasContext(â€˜shareCanvasâ€™,this)â€¦wx.canvasToTempFilePath({ canvasId: â€˜shareCanvasâ€™, success: function(res) { wx.saveImageToPhotosAlbum({ â€¦ },this) }},this)12345æ”¹æˆè¿™æ ·å°±å¯ä»¥äº†ã€‚### éšè— CanvasçŽ°åœ¨æ¥è§£å†³éšè—`canvas`çš„é—®é¢˜ã€‚åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šæ˜¾ç¤º,ç±»ä¼¼äºŽå¼¹æ¡†ï¼ŒåŽé¢æœ‰ä¸ªè’™ç‰ˆçš„æ ·å¼ã€‚`wxml:` 12345è¿™æ ·æˆ‘ä»¬æŽ§åˆ¶`root`å°±å¯ä»¥æŽ§åˆ¶æ•´ä¸ªç»„ä»¶çš„éšè—å’Œæ˜¾ç¤ºäº†ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¿å­˜çš„å›¾ç‰‡éƒ½æ˜¯ç©ºç™½çš„ã€‚èŽ·å–ä¸äº†`canvas`çš„å†…å®¹ã€‚å¦‚æžœåœ¨æ˜¾ç¤ºæƒ…å†µä¸‹æ²¡é—®é¢˜ï¼Œå½“`root`éšè—åŽå°±ä¸è¡Œäº†ã€‚ åœ¨ç½‘ä¸ŠåŸºæœ¬æŸ¥åˆ°è¿™ä¸¤ç§è§£å†³æ–¹æ³•ï¼š æ–¹æ³•ä¸€:è¿™ç§æ–¹æ³•æ¨¡æ‹Ÿå™¨å¯ä»¥ï¼Œä½†æ˜¯åœ¨çœŸæœºä¸Šä¸è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ”¾å¼ƒäº†ã€‚ 12æ–¹æ³•äºŒ: è¿™ç§ä¸»è¦æ˜¯æŠŠ`canvas`æ”¾åˆ°æ— é™è¿œçš„ä½ç½®ï¼Œå¹¶ä¸”è®¾ç½®é¡µé¢ä¸å¯æ»šåŠ¨ã€‚å› ä¸ºæˆ‘è¿™ä¸ªæ˜¯ç»„ä»¶ï¼Œæ‰€ä»¥ä¸ä¸€å®šå“ªä¸ªé¡µé¢è¦ç”¨ï¼Œè§‰å¾—æ¯”è¾ƒéº»çƒ¦ï¼Œæ”¾å¼ƒã€‚ â€œdisableScrollâ€: true123é‚£ä¹ˆæœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•å‘¢? æˆ‘ä»¬åˆ†æžä¸€ä¸‹ï¼Œå½“`root`æ˜¾ç¤ºçš„æƒ…å†µä¸‹`canvas`è¿™ä¸ªæ²¡é—®é¢˜ï¼Œå¦‚æžœ`root`å…ˆéšè—åœ¨æ˜¾ç¤º,`canvas`å°±ä¼šå‡ºçŽ°é—®é¢˜äº†ã€‚é‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½ç›‘å¬`root`éšè—å’Œæ˜¾ç¤ºæ–¹æ³•çš„äº‹ä»¶å‘¢ï¼Ÿå½“æ˜¾ç¤ºå®ŒæˆåŽåœ¨åŽ»ä½¿ç”¨`canvas`å‘¢ï¼Ÿç»è¿‡ä¸€ç¿»æœç´¢åŽï¼Œå¥½åƒä¸èƒ½ç›‘å¬éšè—æ˜¾ç¤ºã€‚ æ¢ä¸ªæ€è·¯ï¼šä¸ç›‘å¬`root`çš„æ˜¾ç¤ºå’Œéšè—ï¼Œç›´æŽ¥ç”¨`setTimeout`è¯•è¯•å‘¢? setTimeout(function() { var canvas = wx.createCanvasContext(â€˜shareCanvasâ€™,this) â€¦ wx.canvasToTempFilePath({ canvasId: â€˜shareCanvasâ€™, success: function(res) { wx.saveImageToPhotosAlbum({ â€¦ },this) } },this)},100)12345å»¶è¿Ÿ0.1ç§’åŽåœ¨æ“ä½œ`canvas`,ðŸ˜†æžœç„¶æˆåŠŸäº†ï¼Œè¯¥æ­»çš„å°ç¨‹åºã€‚### Canvas ç¬¬ä¸€æ¬¡ç©ºç™½æµ‹è¯•å‡ æ¬¡åŽå‘çŽ°ç¬¬ä¸€æ¬¡èŽ·å–çš„å›¾ç‰‡è¿˜æ˜¯ç©ºç™½çš„ï¼Œè€Œä¹‹åŽå°±å¥½äº†ã€‚ç»è¿‡ç ”ç©¶ä¹‹åŽåœ¨`canvas.draw()`å›žè°ƒæ–¹æ³•é‡Œé¢ä¹Ÿæ˜¯å»¶è¿Ÿ0.1ç§’åŽå°±æ²¡é—®é¢˜äº†ã€‚ canvas.draw(false, setTimeout(function() { wx.canvasToTempFilePath({ â€¦ }, this)}, 100))1234### å®Œæ•´ä»£ç `JS`: make: function () { this.setData({ show: &apos;&apos; }) var that = this; setTimeout(function () { var canvas = wx.createCanvasContext(&apos;shareCanvas&apos;, that) canvas.drawImage(&apos;../../image/share-img.png&apos;, 0, 0, that.data.canvasWidth, that.data.canvasWidth * 1.5) canvas.setTextAlign(&apos;center&apos;) canvas.setFillStyle(&apos;#ffffff&apos;) canvas.setFontSize(12) canvas.fillText(&quot;åŠ¨æ€æ–‡å­—&quot;, that.data.canvasWidth * 0.5, that.data.canvasWidth * 1.26) canvas.stroke(); canvas.draw(false, setTimeout(function () { wx.canvasToTempFilePath({ canvasId: &apos;shareCanvas&apos;, success: function (res) { wx.saveImageToPhotosAlbum({ filePath: res.tempFilePath, success: function (res) { console.log(res) } }, that) } }, that) }, 100)) }, 100) } 12`wxml:` `]]></content>
  </entry>
  <entry>
    <title><![CDATA[runtimeèƒ½åšäº›ä»€ä¹ˆ]]></title>
    <url>%2F2018%2Fruntime%E8%83%BD%E5%81%9A%E4%BA%9B%E4%BB%80%E4%B9%88%2F</url>
    <content type="text"><![CDATA[å‰è¨€é¢è¯•çš„æ—¶å€™é¢è¯•å®˜é—®ï¼šè®²è®²å¯¹runtimeçš„ç†è§£ï¼Œruntimeèƒ½åšäº›ä»€ä¹ˆ? æˆ‘åŸºæœ¬ä¸Šå°±æ˜¯å›žç­”åŠ¨æ€æ·»åŠ å±žæ€§ã€æ·»åŠ æ–¹æ³•ã€æ–¹æ³•çš„æ›¿æ¢â€¦â€¦ç­‰ç½‘ç»œç½—åˆ—çš„ä¸€å¤§å †ã€‚ä½†æ˜¯å…·ä½“æ€Žä¹ˆåšï¼Œè¿™ä¸ªå˜›ï¼Œæˆ‘ä¹Ÿè¯´ä¸å‡ºæ¥ã€‚åŸºäºŽæ­¤ï¼Œæˆ‘ç‰¹åœ°ç ”ç©¶äº†ä¸€ä¸‹runtime.hè¿™ä¸ªæ–‡ä»¶ï¼Œè¿‡æ»¤äº†ä¸€ä¸‹é‡Œé¢æ‰€æœ‰çš„æ–¹æ³•å¹¶ä¸”äº†è§£åŸºæœ¬åŠŸèƒ½å¹¶è®°å½•åœ¨æ­¤ã€‚ å‡†å¤‡è¿›å…¥åˆ°runtime.hæ–‡ä»¶é‡Œé¢ï¼Œå‘çŽ°é‡Œé¢æœ‰äº›æ–¹æ³•æ ‡è®°çš„æ˜¯OBJC_ARC_UNAVAILABLEï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å•ç‹¬åˆ›å»ºä¸€ä¸ªMRCé¡¹ç›®ï¼Œä»¥ä¾¿äºŽå°è¯•æ‰€æœ‰æ–¹æ³•ã€‚ åˆ›å»ºé¡¹ç›®è¿™é‡Œæˆ‘ä»¬åˆ›å»ºCommand Line Toolå·¥ç¨‹å³å¯ï¼Œå¦‚å›¾ä¸€: MRCé¡¹ç›®åˆ›å»ºå®ŒæˆåŽï¼Œé»˜è®¤æ˜¯ARCæ¨¡å¼çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸ºMRCã€‚åœ¨TATGET-&gt; Build Settings-&gt;Objective-C Automatic Reference Counting-&gt;NO,é»˜è®¤ä¸ºYESè¡¨ç¤ºä½¿ç”¨ARCæ¨¡å¼ï¼Œè¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ä¸ºNOå³å¯ã€‚ ç±»åˆ›å»ºæˆ‘ä»¬çš„æµ‹è¯•ç±»ï¼Œåˆ›å»ºAnimalç±»ï¼Œæ·»åŠ ä¸€ä¸ªnameå±žæ€§å’Œä¸€ä¸ªspeakæ–¹æ³•,ä¸€èµ·çœ‹ä¸‹ç±»çš„æž„é€ : æ–¹æ³•ä»‹ç»å‡†å¤‡å¥½äº†ä¹‹åŽï¼Œæ¥åˆ°main.mæ–‡ä»¶,å¯¼å…¥objc/runtime.hå’ŒAnimal.hå¤´æ–‡ä»¶æ–‡ä»¶ã€‚ å®žä¾‹æ–¹æ³•object_copyåŽŸåž‹: 123OBJC_EXPORT id _Nullable object_copy(id _Nullable obj, size_t size)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0)OBJC_ARC_UNAVAILABLE; æè¿°:æ‹·è´å¯¹è±¡ç”¨çš„,å’Œcopyæ–¹æ³•ä¸€æ ·,è¿”å›žä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚å‚æ•°:objè¢«æ‹·è´çš„å¯¹è±¡ï¼Œsizeå¯¹è±¡çš„å ç”¨å†…å­˜å¤§å°ï¼Œä»Žæºç å¯çŸ¥ï¼Œsizeæœ€å°ä¸º16ã€‚æ³¨æ„:è¿™ä¸ªæ–¹æ³•æ˜¯OBJC_ARC_UNAVAILABLEï¼Œåœ¨ARCä¸‹ä¸å¯ç”¨,è€Œä¸”å¦‚æžœå‚æ•°objä¸ºnil æˆ–è€…æ˜¯TaggedPointer,åˆ™ç›´æŽ¥è¿”å›žobj,å¹¶ä¸è¿›è¡Œæ‹·è´ã€‚ object_disposeåŽŸåž‹: 123OBJC_EXPORT id _Nullable object_dispose(id _Nullable obj)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0)OBJC_ARC_UNAVAILABLE; æè¿°:é”€æ¯å¯¹è±¡ï¼Œå¹¶ä¸”é‡Šæ”¾ç©ºé—´ã€‚å‚æ•°:objè¦é‡Šæ”¾çš„å¯¹è±¡ã€‚æ³¨æ„:åœ¨demoä¸­,è°ƒç”¨æ­¤æ–¹æ³•åŽï¼Œå¯¹è±¡è¿˜æ˜¯èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œæ²¡æœ‰æŸ¥æ‰¾åˆ°åŽŸå› ï¼Œæ”¹å¤©ç ”ç©¶ä¸‹å•åˆ—ä¸€ç¯‡æ–‡ç« ã€‚æºç : 1234567id object_dispose(id obj)&#123; if (!obj) return nil; objc_destructInstance(obj); free(obj); return nil;&#125; ä»Žæºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆåˆ¤æ–­objæ˜¯å¦ä¸ºç©ºï¼Œå¦åˆ™è°ƒç”¨objc_destructInstanceé”€æ¯å¯¹è±¡,ç„¶åŽè°ƒç”¨free()é‡Šæ”¾ç©ºé—´ã€‚ object_getClassåŽŸåž‹: 123OBJC_EXPORT Class _Nullableobject_getClass(id _Nullable obj) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°:èŽ·å–å¯¹è±¡çš„Classï¼Œå’Œå¯¹è±¡ç›´æŽ¥è°ƒç”¨classæ–¹æ³•åŸºæœ¬ä¸€è‡´,å†…éƒ¨å®žçŽ°æ˜¯è¿”å›žobjçš„isaæŒ‡é’ˆï¼Œå¯¹äºŽisaæŒ‡é’ˆè¿™é‡Œä¸èµ˜è¿°ã€‚æ³¨æ„:å¦‚æžœobjä¼ nil,åˆ™è¿”å›žå€¼ä¸ºNil object_setClassåŽŸåž‹: 123OBJC_EXPORT Class _Nullableobject_setClass(id _Nullable obj, Class _Nonnull cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°: ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç±»,ç›®çš„æ˜¯ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„isaæŒ‡é’ˆ,è¿”å›žå€¼æ˜¯æ—§çš„classã€‚æ³¨æ„:è°ƒç”¨æ­¤æ–¹æ³•ä¹‹åŽï¼Œå¯¹è±¡çš„ç±»åž‹å°±ä¼šæ”¹å˜ï¼Œæ‰€ä»¥åœ¨å¼€å‘ä¸­åº”è¯¥è°¨æ…Žä½¿ç”¨æ­¤æ–¹æ³•ã€‚ç”±ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè°ƒç”¨object_setClassæ–¹æ³•åŽï¼Œa1ç”±åŽŸæ¥çš„Animal å˜æˆNSObjectå¯¹è±¡ï¼Œç„¶åŽåœ¨å‘aå‘é€æ¶ˆæ¯ç«‹å³å´©æºƒã€‚å´©æºƒä¿¡æ¯æç¤ºNSObjectä¸å­˜åœ¨setNameæ–¹æ³•ã€‚ object_isClassåŽŸåž‹: 123OBJC_EXPORT BOOLobject_isClass(id _Nullable obj) OBJC_AVAILABLE(10.10, 8.0, 9.0, 1.0, 2.0); æè¿°:åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç±»å¯¹è±¡ï¼Œæ³¨æ„:ç±»ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…·ä½“ä¸ºä»€ä¹ˆï¼Œè¿™é‡Œä¸ä¼šèµ˜è¿°ã€‚ç”±ä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œa1ä¸æ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥ä»–ä¸æ˜¯ç±»å¯¹è±¡ï¼ŒAnimalæ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥è¿”å›žTRUEã€‚ object_getIvaråŽŸåž‹: 123OBJC_EXPORT id _Nullableobject_getIvar(id _Nullable obj, Ivar _Nonnull ivar) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°: èŽ·å–objçš„ivarçš„å€¼ã€‚å’Œè¿™ä¸ªæ–¹æ³•åŠŸèƒ½ç±»ä¼¼çš„è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•object_setInstanceVariable,ä½†æ˜¯è¿™ä¸ªèŽ·å–çš„ç»“æžœé€Ÿåº¦å›žæ›´å¿«ä¸€äº›ï¼Œä»Žobject_setInstanceVariableæºç ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œæœ€ç»ˆä¹Ÿæ˜¯è°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•ã€‚ä¸ºäº†æµ‹è¯•æ­¤æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸ºAnimalç±»æ·»åŠ ä¸€ä¸ªå˜é‡ageã€‚ç”±ä¸‹å›¾ä¹Ÿå¯ä»¥çœ‹å‡ºå±žæ€§å’Œå˜é‡çš„åŒºåˆ«ã€‚ object_getInstanceVariableåŽŸåž‹: 12345OBJC_EXPORT Ivar _Nullableobject_getInstanceVariable(id _Nullable obj, const char * _Nonnull name, void * _Nullable * _Nullable outValue)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0)OBJC_ARC_UNAVAILABLE; æè¿°:è¿™ä¸ªæ–¹æ³•å’Œä¸Šä¸ªæ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿæ˜¯èŽ·å–å±žæ€§æˆ–è€…å˜é‡çš„å€¼ï¼Œåªä¸è¿‡å‚æ•°å’Œè¿”å›žå€¼ä¸åŒã€‚å‚æ•°:objè¢«èŽ·å–çš„å¯¹è±¡;nameå˜é‡çš„åç§°,å­—ç¬¦ä¸²æ ¼å¼;outValueè¿™ä¸ªå˜é‡çš„å€¼ã€‚é€šè¿‡æºç å¯ä»¥çœ‹å‡ºè¿™ä¸ªæ–¹æ³•çš„å®žçŽ°è¿‡ç¨‹å°±æ˜¯é€šè¿‡nameèŽ·å–Ivar,ç„¶åŽè°ƒç”¨ä¸Šè¿°æ–¹æ³•ã€‚æ‰€ä»¥å®˜æ–¹æ³¨é‡Šä¸Šè¯´æ­¤æ–¹æ³•æ…¢ä¸Žä¸Šè¿°æ–¹æ³•ã€‚è¿™é‡Œå°±ä¸ä¸Šå›¾äº†ï¼Œå›¾å’ŒðŸ‘†çš„ä¸€æ ·ã€‚ object_setIvarobject_setIvarWithStrongDefaultåŽŸåž‹: 123OBJC_EXPORT voidobject_setIvar(id _Nullable obj, Ivar _Nonnull ivar, id _Nullable value) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); 1234OBJC_EXPORT voidobject_setIvarWithStrongDefault(id _Nullable obj, Ivar _Nonnull ivar, id _Nullable value) OBJC_AVAILABLE(10.12, 10.0, 10.0, 3.0, 2.0); æè¿°:å› ä¸ºè¿™ä¸¤ä¸ªæ–¹æ³•åŸºæœ¬ç›¸åŒ,æ‰€ä»¥è¿™é‡Œæ”¾åœ¨ä¸€å—è¯´äº†ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ç»™å˜é‡èµ‹å€¼ï¼Œç›¸å½“äºŽa1.name=æˆ‘æ˜¯å°ç‹—ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«åœ¨äºŽç¬¬ä¸€ä¸ªä¼šç»™å±žæ€§ç”¨Unretainedä¿®é¥°ï¼Œç¬¬äºŒä¸ªä¼šç”¨Strongä¿®é¥°ï¼Œæ³¨æ„è¿™ä¸ªå‰ææ˜¯è¿™ä¸ªå±žæ€§æ²¡æœ‰è¢«ä¿®é¥°çš„æƒ…å†µä¸‹æ‰ä¼šèµ·ä½œç”¨ã€‚æ¯”å¦‚nameå·²ç»è¢«copyä¿®é¥°äº†ï¼Œé‚£å°±ä¿æŒåŽŸæ¥çš„æ ·å­ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚å‚æ•°:objè¢«èµ‹å€¼çš„å¯¹è±¡;Ivarå³å°†èµ‹å€¼çš„å˜é‡,valueè¢«èµ‹çš„å€¼ã€‚æ³¨æ„:å¦‚æžœå¯¹è±¡æ²¡æœ‰è¿™ä¸ªå±žæ€§ï¼Œæ˜¯ä¸èƒ½èµ‹å€¼çš„ã€‚ object_setInstanceVariableobject_setInstanceVariableWithStrongDefaultåŽŸåž‹: 12345OBJC_EXPORT Ivar _Nullableobject_setInstanceVariable(id _Nullable obj, const char * _Nonnull name, void * _Nullable value)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0)OBJC_ARC_UNAVAILABLE; 123456OBJC_EXPORT Ivar _Nullableobject_setInstanceVariableWithStrongDefault(id _Nullable obj, const char * _Nonnull name, void * _Nullable value)OBJC_AVAILABLE(10.12, 10.0, 10.0, 3.0, 2.0)OBJC_ARC_UNAVAILABLE; æè¿°:è¿™ä¸¤ä¸ªæ–¹æ³•å’Œä¸Šé¢ä¸¤ä¸ªæ–¹æ³•åŸºæœ¬ç›¸åŒ,åªæ˜¯å‚æ•°å’Œè¿”å›žå€¼ä¸åŒï¼Œä»Žæºç å¯ä»¥çœ‹å‡ºå†…éƒ¨è°ƒç”¨çš„ä¹Ÿæ˜¯ä¸Šè¿°ä¸¤ä¸ªæ–¹æ³•è€Œå·²ã€‚ç›´æŽ¥æ¼”ç¤ºä½¿ç”¨æ–¹æ³•ï¼š èŽ·å¾—ç±»å®šä¹‰objc_getClassobjc_lookUpClassåŽŸåž‹: 123OBJC_EXPORT Class _Nullableobjc_getClass(const char * _Nonnull name)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); 123OBJC_EXPORT Class _Nullableobjc_lookUpClass(const char * _Nonnull name)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); æè¿°:ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²èŽ·å–ä¸€ä¸ªClass,å¹¶ä¸”æ•´ä¸ªç±»æ˜¯åœ¨å·¥ç¨‹é‡Œé¢å­˜åœ¨çš„ï¼Œå¦åˆ™ä¼šè¿”å›žnilã€‚æ³¨é‡Šä¸Šè¯´objc_getClassæ–¹æ³•ä¼šåœ¨ç¬¬ä¸€æ¬¡æ²¡æœ‰æ‰¾åˆ°Classçš„æƒ…å†µä¸‹ä¼šå†æ¬¡æŸ¥è¯¢ä¸€å˜å¹¶ä¸”æ‰§è¡Œå›žè°ƒã€‚ä»Žæºç ä¸Šé¢çœ‹ç€ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯æ‰§è¡Œäº†look_up_class(const char *aClassName, bool includeUnconnected, bool includeClassHandler)è¿™ä¸ªæ–¹æ³•ã€‚åŒºåˆ«åœ¨äºŽincludeClassHandlerè¿™ä¸ªå‚æ•°ã€‚objc_getClassä¼ çš„æ˜¯YESï¼Œè€ŒåŽè€…æ˜¯NOã€‚åœ¨look_up_classå®žçŽ°ä¸Šçœ‹ï¼Œæ—§ç‰ˆæœ¬çš„å®žçŽ°æ˜¯æŒ‰ç…§æ³¨é‡Šä¸Šæ‰€è¯´çš„ä¸€æ ·ã€‚ä½†æ˜¯æ–°ç‰ˆæœ¬çš„è¿™ä¸ªå‚æ•°è¢«æ ‡è®°ä¸ºunused,åŸºæœ¬ä¸ŠçŽ°åœ¨ä¸¤ä¸ªæ–¹æ³•ç›¸åŒã€‚ objc_getRequiredClassåŽŸåž‹: 123OBJC_EXPORT Class _Nonnullobjc_getRequiredClass(const char * _Nonnull name)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); æè¿°:è¿™ä¸ªæ–¹æ³•å’Œä¸Šé¢çš„objc_getClassæ–¹æ³•åŸºæœ¬ä¸€è‡´ï¼Œå†…éƒ¨è°ƒç”¨çš„å°±æ˜¯objc_getClassè¿™ä¸ªæ–¹æ³•ï¼Œåªä¸è¿‡åœ¨æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œä¼šæŠ¥é“¾æŽ¥å¤±è´¥ã€‚è´´ä¸‹æºç : 123456Class objc_getRequiredClass(const char *aClassName)&#123; Class cls = objc_getClass(aClassName); if (!cls) _objc_fatal(&quot;link error: class &apos;%s&apos; not found.&quot;, aClassName); return cls;&#125; objc_getMetaClassåŽŸåž‹: 123OBJC_EXPORT Class _Nonnullobjc_getMetaClass(const char * _Nonnull name)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); æè¿°:èŽ·å–ç±»çš„å…ƒç±»,è¿™ä¸ªæ–¹æ³•å’Œobjc_getRequiredClassåŸºæœ¬ç±»ä¼¼ï¼Œä¹Ÿæ˜¯è°ƒç”¨äº†objc_getClassè¿™ä¸ªæ–¹æ³•ï¼Œåªä¸è¿‡åœ¨æ²¡æœ‰æ‰¾åˆ°Classçš„æ—¶å€™ä¼šæŠ¥æç¤ºä¿¡æ¯ï¼Œä¸ä¼šCrash,ç„¶åŽä¼šè¿”å›žNil,æœ€ç»ˆè¿”å›žClassçš„isaæŒ‡é’ˆã€‚ä»Žå›¾ä¸­çœ‹åˆ°æŽ§åˆ¶å°é‡Œé¢æ‰“å°ä¿¡æ¯ã€‚è´´ä¸‹æºç : 123456789101112131415Class objc_getMetaClass(const char *aClassName)&#123; Class cls; if (!aClassName) return Nil; cls = objc_getClass (aClassName); if (!cls) &#123; _objc_inform (&quot;class `%s&apos; not linked into application&quot;, aClassName); return Nil; &#125; return cls-&gt;ISA();&#125; objc_getClassListåŽŸåž‹: 123OBJC_EXPORT int objc_getClassList(Class _Nonnull * _Nullable buffer, int bufferCount)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); æè¿°:èŽ·å–æŒ‡å®šçš„ä¸ªæ•°ç±»åˆ—è¡¨ã€‚bufferéœ€è¦ä¼ å…¥ä¸€ä¸ªClassæ•°ç»„ï¼ŒbufferCountéœ€è¦ä¼ å…¥æƒ³è¦çš„ä¸ªæ•°,è¿”å›žå€¼æ˜¯ç±»çš„æ€»æ•°ã€‚å¦‚æžœbufferCountä¼ å…¥çš„æ•°æ¯”ç±»çš„æ€»æ•°å¤§ï¼Œåˆ™æœ€å¤šèƒ½è¿”å›žæ‰€æœ‰çš„ç±»ã€‚å¦‚æžœbufferCountæ¯”ç±»çš„æ€»æ•°å°ï¼Œåˆ™ä¼šè¿”å›žè¿™ä¸ªä¸ªæ•°çš„ç±»ï¼Œä»Žä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°å·²ç»æœ‰13062ä¸ªç±»äº†ã€‚æ³¨æ„:èŽ·å–çš„ç±»æœ‰å¯èƒ½ä¸æ˜¯NSObjectçš„å­ç±»ï¼Œæ‰€ä»¥è¦å°å¿ƒè°ƒç”¨è¿™äº›ç±»çš„æ–¹æ³•.å›¾ä¸­å®žä¾‹èŽ·å–10ä¸ªç±»: objc_copyClassListåŽŸåž‹: 123OBJC_EXPORT Class _Nonnull * _Nullableobjc_copyClassList(unsigned int * _Nullable outCount)OBJC_AVAILABLE(10.7, 3.1, 9.0, 1.0, 2.0); æè¿°:è¿™ä¸ªæ–¹æ³•å’Œä¸Šé¢çš„æ–¹æ³•ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™ä¸ªæ˜¯ä¸€æ¬¡æ€§èŽ·å–æ‰€æœ‰çš„ç±»ï¼ŒoutCountå‘å¤–è¾“å‡ºç±»çš„æ€»ä¸ªæ•°ã€‚æ³¨æ„:è¿™ä¸ªæ–¹æ³•è¿”å›žå€¼æ˜¯ClassæŒ‡é’ˆï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨å®ŒæˆåŽéœ€è¦è°ƒç”¨free()è¿›è¡Œé‡Šæ”¾ã€‚ ç±»æ–¹æ³•class_getNameåŽŸåž‹: 123OBJC_EXPORT const char * _Nonnullclass_getName(Class _Nullable cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°: èŽ·å–Classçš„åå­—ï¼Œè¿”å›žå€¼ç±»åž‹æ˜¯const char *ã€‚è¿™ä¸ªåœ¨ç®€å•ä¸è¿‡ï¼Œä¸Šå›¾å·²ç»æ¼”ç¤ºäº†ã€‚ä¸åœ¨èµ˜è¿°ã€‚ class_isMetaClassåŽŸåž‹: 123OBJC_EXPORT BOOLclass_isMetaClass(Class _Nullable cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°:åˆ¤æ–­ä¸€ä¸ªClassæ˜¯å¦æ˜¯å…ƒç±»ï¼Œè¿”å›žå€¼æ˜¯boolç±»åž‹ã€‚ class_getSuperclassåŽŸåž‹: 123OBJC_EXPORT Class _Nullableclass_getSuperclass(Class _Nullable cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°:èŽ·å–Classçš„çˆ¶ç±»ã€‚ å’ŒOCçš„superclassåŠŸèƒ½ä¸€æ ·ã€‚ä»Žä¸‹å›¾å¯ä»¥çœ‹å‡ºAnimalçš„çˆ¶ç±»æ˜¯NSObjectã€‚ class_setSuperclassåŽŸåž‹: 1234567OBJC_EXPORT Class _Nonnullclass_setSuperclass(Class _Nonnull cls, Class _Nonnull newSuper) __OSX_DEPRECATED(10.5, 10.5, &quot;not recommended&quot;) __IOS_DEPRECATED(2.0, 2.0, &quot;not recommended&quot;) __TVOS_DEPRECATED(9.0, 9.0, &quot;not recommended&quot;) __WATCHOS_DEPRECATED(1.0, 1.0, &quot;not recommended&quot;)__BRIDGEOS_DEPRECATED(2.0, 2.0, &quot;not recommended&quot;); æè¿°:æ”¹å˜æŸä¸ªClassçš„çˆ¶ç±»ã€‚ä¸€å®šè¦è°¨æ…Žä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚è¢«æ ‡è®°ä¸ºnot recommendedã€‚è¿”å›žå€¼æ˜¯å°±çš„çˆ¶ç±»ã€‚çœ‹ä¸‹å›¾ï¼Œå½“æŠŠAnimalçš„çˆ¶ç±»æ”¹æˆNSStringä¹‹åŽï¼ŒæŠŠa1å½“åšå­—ç¬¦ä¸²æ“ä½œï¼Œè¿è¡Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯å½“è°ƒç”¨AnimalåŽŸæ¥çš„æ–¹æ³•ä¹‹åŽï¼Œå°±ä¼šæŠ¥æ–¹æ³•æ‰¾ä¸åˆ°ã€‚ class_getVersionclass_setVersion123OBJC_EXPORT intclass_getVersion(Class _Nullable cls)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); 123OBJC_EXPORT voidclass_setVersion(Class _Nullable cls, int version)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); æè¿°:è¿™ä¸¤ä¸ªæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ”¾ä¸€å—è¯´äº†ï¼Œå…¶å®žå°±æ˜¯è®¾ç½®å’ŒèŽ·å–Classçš„ç‰ˆæœ¬ã€‚ ç›´æŽ¥ä¸Šå›¾: class_getInstanceSizeåŽŸåž‹: 123OBJC_EXPORT size_tclass_getInstanceSize(Class _Nullable cls) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°:èŽ·å–è¿™ä¸ªç±»æ‰€å ç”¨å­—èŠ‚æ•°ã€‚ä¸è¯¦ç»†è®²äº†ï¼Œç½‘ä¸Šéƒ½æ˜¯è®²è§£ã€‚ class_getInstanceVariableåŽŸåž‹: 123OBJC_EXPORT Ivar _Nullableclass_getInstanceVariable(Class _Nullable cls, const char * _Nonnull name)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); æè¿°:é€šè¿‡ä¸€ä¸ªClass èŽ·å–æŒ‡å®šå±žæ€§ã€‚ è¿™ä¸ªå’Œobject_getInstanceVariableåŸºæœ¬ä¸€è‡´ï¼Œè¿”å›žçš„æ˜¯åŒä¸€ä¸ªIvarå¯¹è±¡ã€‚åªä¸è¿‡object_getInstanceVariable ä¼šå‘å¤–è¾“å‡ºå€¼ã€‚ class_getClassVariableåŽŸåž‹: 123OBJC_EXPORT Ivar _Nullableclass_getClassVariable(Class _Nullable cls, const char * _Nonnull name) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°: è¿™ä¸ªæ–¹æ³•è‡³å°‘æˆ‘è®¤ä¸ºåŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆç”¨å¤„ã€‚ç”±å­—é¢æ„æ€çœ‹æ˜¯èŽ·å–ç±»å˜é‡ï¼ŒOCè¯­æ³•ä¹Ÿä¸æ”¯æŒè¿™ä¸ªã€‚ä»Žæºç ä¸Šæ¥çœ‹è¿™ä¸ªå°±æ˜¯èŽ·å–ISAæŒ‡é’ˆçš„å±žæ€§ï¼Œå›¾ä¸Šæ¼”ç¤ºçš„æ˜¯ç­‰æ•ˆçš„ã€‚ class_copyIvarListåŽŸåž‹: 123OBJC_EXPORT Ivar _Nonnull * _Nullableclass_copyIvarList(Class _Nullable cls, unsigned int * _Nullable outCount) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°:æˆ‘ä¼°è®¡è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬æŽ¥è§¦çš„æ¯”è¾ƒå¤šï¼Œå› ä¸ºåœ¨åˆ©ç”¨runtimeå½’æ¡£ ã€è§£æ¡£éœ€è¦ç”¨åˆ°è¿™ä¸ªæ–¹æ³•ï¼›è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯è¿”å›žClassçš„æ‰€æœ‰å˜é‡ï¼Œè¿”å›žå€¼æ˜¯ä¸€ä¸ªIvaræ•°ç»„ã€‚æ³¨æ„:åœ¨ç”¨å®ŒIvaræ•°ç»„ä¹‹åŽï¼Œå¿…é¡»è°ƒç”¨free()å‡½æ•°è¿›è¡Œé‡Šæ”¾ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ class_getInstanceMethodåŽŸåž‹: 123OBJC_EXPORT Method _Nullableclass_getInstanceMethod(Class _Nullable cls, SEL _Nonnull name)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); æè¿°:é€šè¿‡SELèŽ·å–Method,è¿™ä¸ªæ–¹æ³•ä¼°è®¡ä¹Ÿå¾ˆç†Ÿæ‚‰ï¼Œåœ¨æ–¹æ³•æ›¿æ¢çš„çš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªæ¥èŽ·å–å®žä¾‹æ–¹æ³•çš„ã€‚æ³¨æ„:å¦‚æžœæ–¹æ³•åªåœ¨.hå£°æ˜Žï¼Œä½†æ˜¯æ²¡æœ‰åœ¨.mé‡Œé¢å®žçŽ°çš„è¯ï¼Œæ˜¯æ‰¾ä¸åˆ°æ­¤æ–¹æ³•çš„ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨å½“å‰Classæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„SELçš„æ—¶å€™ï¼Œä¼šä¸€ç›´å‘çˆ¶çº§æŸ¥æ‰¾, å¦‚ä¸‹å›¾éƒ½èƒ½æ­£ç¡®æ‰¾åˆ°æ–¹æ³•çš„åœ°å€ã€‚ class_getClassMethodåŽŸåž‹: 123OBJC_EXPORT Method _Nullableclass_getClassMethod(Class _Nullable cls, SEL _Nonnull name)OBJC_AVAILABLE(10.0, 2.0, 9.0, 1.0, 2.0); æè¿°:èŽ·å–ç±»æ–¹æ³•ï¼Œå’Œclass_getInstanceMethodåŸºæœ¬å·®ä¸å¤šã€‚ä¸ºäº†æµ‹è¯•æ­¤æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ä¸ºAnimalæ·»åŠ ä¸€ä¸ªrunæ–¹æ³•ï¼Œå¹¶ä¸”åœ¨.mé‡Œé¢å®žçŽ°,æ­¤æ–¹æ³•èƒ½æ­£ç¡®è¿”å›žã€‚å¦‚å›¾: class_getMethodImplementationåŽŸåž‹: 123OBJC_EXPORT IMP _Nullableclass_getMethodImplementation(Class _Nullable cls, SEL _Nonnull name) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°: èŽ·å–æ–¹æ³•çš„å®žçŽ°ã€‚ class_getMethodImplementation_stretåŽŸåž‹: 1234OBJC_EXPORT IMP _Nullableclass_getMethodImplementation_stret(Class _Nullable cls, SEL _Nonnull name) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0)OBJC_ARM64_UNAVAILABLE; æè¿°:èŽ·å–æ–¹æ³•çš„è½¬å‘æ¶ˆæ¯çš„å®žçŽ°ã€‚ class_respondsToSelectoråŽŸåž‹ï¼š 123OBJC_EXPORT BOOLclass_respondsToSelector(Class _Nullable cls, SEL _Nonnull sel) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°: åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦å®žçŽ°äº†æŸä¸ªæ–¹æ³•ã€‚å’Œ[NSObject respondsToSelector:@selector()];æ–¹æ³•ä¸€æ ·ã€‚ class_copyMethodListåŽŸåž‹: 123OBJC_EXPORT Method _Nonnull * _Nullableclass_copyMethodList(Class _Nullable cls, unsigned int * _Nullable outCount) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°:èŽ·å–æ‰€æœ‰çš„Classå®žçŽ°çš„å®žä¾‹æ–¹æ³•ã€‚ä¸åŒ…æ‹¬ç±»æ–¹æ³•ï¼Œä¹Ÿä¸åŒ…æ‹¬çˆ¶ç±»æ–¹æ³•ã€‚æ³¨æ„:æ­¤æ–¹æ³•ä¼šè¿”å›žMethodæ•°ç»„ï¼Œåœ¨ç”¨å®Œä¹‹åŽéœ€è¦è°ƒç”¨free()é‡Šæ”¾ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ä»Žä¸‹å›¾å¯ä»¥çœ‹å‡ºï¼Œç»™ç±»æ·»åŠ å±žæ€§ä¹‹åŽï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆget setæ–¹æ³•ã€‚ class_conformsToProtocolåŽŸåž‹: 123OBJC_EXPORT BOOLclass_conformsToProtocol(Class _Nullable cls, Protocol * _Nullable protocol) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°ï¼šåˆ¤æ–­Classæ˜¯å¦éµå¾ªæŸä¸ªåè®®.å’Œ[NSObject conformsToProtocol:]æ–¹æ³•ä¸€æ ·ã€‚ class_copyProtocolListåŽŸåž‹: 123OBJC_EXPORT Protocol * __unsafe_unretained _Nonnull * _Nullable class_copyProtocolList(Class _Nullable cls, unsigned int * _Nullable outCount)OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°ï¼šèŽ·å–Classæ‰€æœ‰éµå¾ªçš„åè®®ã€‚è¿”å›žå€¼æ˜¯ä¸€ä¸ªOCç±»æ•°ç»„Protocol **ã€‚æ³¨æ„:åœ¨ä½¿ç”¨å®ŒåŽè°ƒç”¨free()æ–¹æ³•é‡Šæ”¾å†…å­˜ã€‚ class_getPropertyåŽŸåž‹: 123OBJC_EXPORT objc_property_t _Nullableclass_getProperty(Class _Nullable cls, const char * _Nonnull name)OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°ï¼šé€šè¿‡nameèŽ·å–æŒ‡å®šçš„å±žæ€§ã€‚ ä»…ä»…åŒ…å«@propertyæ ‡è®°çš„å±žæ€§ã€‚ä¸åŒ…å«å˜é‡å’Œçˆ¶çº§å±žæ€§,å¦‚ä¸‹å›¾å´©æºƒåŽŸå› æ˜¯æ²¡ç”¨èŽ·å–åˆ°ageå±žæ€§ï¼Œè°ƒç”¨ç›¸åº”çš„æ–¹æ³•ç›´æŽ¥æŠ¥é”™ã€‚ class_copyPropertyListåŽŸåž‹: 123OBJC_EXPORT objc_property_t _Nonnull * _Nullableclass_copyPropertyList(Class _Nullable cls, unsigned int * _Nullable outCount)OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); æè¿°ï¼šèŽ·å–æ‰€æœ‰çš„å±žæ€§ï¼Œä»…ä»…åŒ…å«@propertyæ ‡è®°çš„å±žæ€§ã€‚ä¸åŒ…å«å˜é‡å’Œçˆ¶çº§å±žæ€§ã€‚æ³¨æ„:è¯¥æ–¹æ³•è¿”å›žå€¼æ˜¯ä¸€ä¸ªobjc_property_t æ•°ç»„ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨å®ŒåŽä¸€å®šè¦è°ƒç”¨free()æ–¹æ³•é‡Šæ”¾å†…å­˜ï¼Œå¦åˆ™ä¼šå¯¼è‡´å†…å­˜æ³„éœ²ã€‚ class_getIvarLayoutåŽŸåž‹: 123OBJC_EXPORT const uint8_t * _Nullableclass_getIvarLayout(Class _Nullable cls)OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); class_getWeakIvarLayoutåŽŸåž‹: 123OBJC_EXPORT const uint8_t * _Nullableclass_getWeakIvarLayout(Class _Nullable cls)OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); class_addMethodåŽŸåž‹: 1234OBJC_EXPORT BOOLclass_addMethod(Class _Nullable cls, SEL _Nonnull name, IMP _Nonnull imp, const char * _Nullable types) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); class_replaceMethodåŽŸåž‹: 1234OBJC_EXPORT IMP _Nullableclass_replaceMethod(Class _Nullable cls, SEL _Nonnull name, IMP _Nonnull imp, const char * _Nullable types) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); class_addIvaråŽŸåž‹: 1234OBJC_EXPORT BOOLclass_addIvar(Class _Nullable cls, const char * _Nonnull name, size_t size, uint8_t alignment, const char * _Nullable types) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); class_addProtocolåŽŸåž‹: 123OBJC_EXPORT BOOLclass_addProtocol(Class _Nullable cls, Protocol * _Nonnull protocol) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); class_addPropertyåŽŸåž‹: 12345OBJC_EXPORT BOOLclass_addProperty(Class _Nullable cls, const char * _Nonnull name, const objc_property_attribute_t * _Nullable attributes, unsigned int attributeCount)OBJC_AVAILABLE(10.7, 4.3, 9.0, 1.0, 2.0); class_replacePropertyåŽŸåž‹: 12345OBJC_EXPORT voidclass_replaceProperty(Class _Nullable cls, const char * _Nonnull name, const objc_property_attribute_t * _Nullable attributes, unsigned int attributeCount)OBJC_AVAILABLE(10.7, 4.3, 9.0, 1.0, 2.0); class_setIvarLayoutåŽŸåž‹: 123OBJC_EXPORT voidclass_setIvarLayout(Class _Nullable cls, const uint8_t * _Nullable layout)OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); class_setWeakIvarLayoutåŽŸåž‹: 123OBJC_EXPORT voidclass_setWeakIvarLayout(Class _Nullable cls, const uint8_t * _Nullable layout)OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0); objc_getFutureClassåŽŸåž‹: 1234OBJC_EXPORT Class _Nonnullobjc_getFutureClass(const char * _Nonnull name) OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0)OBJC_ARC_UNAVAILABLE; å®žä¾‹åŒ–ç±»class_createInstanceobjc_constructInstanceobjc_destructInstanceæ·»åŠ ç±»objc_allocateClassPairobjc_registerClassPairobjc_duplicateClassobjc_disposeClassPairæ–¹æ³•method_getNamemethod_getImplementationmethod_getTypeEncodingmethod_getNumberOfArgumentsmethod_copyReturnTypemethod_copyArgumentTypemethod_getReturnTypemethod_getArgumentTypemethod_getDescriptionmethod_setImplementationmethod_exchangeImplementationså®žä¾‹å˜é‡ivar_getNameivar_getTypeEncodingivar_getOffsetå±žæ€§property_getNameproperty_getAttributesproperty_copyAttributeListproperty_copyAttributeValueåè®®objc_getProtocolobjc_copyProtocolListprotocol_conformsToProtocolprotocol_isEqualprotocol_getNameprotocol_getMethodDescriptionprotocol_copyMethodDescriptionListprotocol_getPropertyprotocol_copyPropertyListprotocol_copyPropertyList2protocol_copyProtocolListobjc_allocateProtocolobjc_registerProtocolprotocol_addMethodDescriptionprotocol_addProtocolprotocol_addPropertyåº“objc_copyImageNamesclass_getImageNameobjc_copyClassNamesForImageé€‰æ‹©å™¨sel_getNamesel_registerNamesel_isEqualobjc_enumerationMutationobjc_setEnumerationMutationHandlerobjc_setForwardHandlerimp_implementationWithBlockimp_getBlockimp_removeBlockobjc_loadWeakobjc_storeWeakæ·»åŠ å˜é‡objc_setAssociatedObjectobjc_getAssociatedObjectobjc_removeAssociatedObjects]]></content>
  </entry>
  <entry>
    <title><![CDATA[.NetPKç³»ç»Ÿ]]></title>
    <url>%2F2018%2F%E4%BC%98%E6%B3%8C%E4%B9%90PK%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[é¡¹ç›®ç®€ä»‹å‰äº›å¤©å…¬å¸æŽ¥åˆ°ä¸€ä¸ªåœ¨çº¿PKçš„é¡¹ç›®ï¼Œç”¨æˆ·éœ€æ±‚æ˜¯æ¨¡ä»¿å¾®ä¿¡å°ç¨‹åºçš„ã€Šå¤´è„‘çŽ‹è€…ã€‹ï¼Œä¸è¿‡ä¼šæ¯”è¿™ä¸ªç®€å•äº›ï¼Œé¢˜ç›®æ˜¯å…¬å¸å†…éƒ¨æ‹Ÿå®šå¥½çš„ï¼Œéƒ½æ˜¯å…³äºŽç–¾ç—…ä¹‹ç±»çš„æ¯”å¦‚ç³–å°¿ç—…ã€å¿ƒè„ç—…ç­‰ç­‰ã€‚è¿˜æœ‰å°±æ˜¯é¡¹ç›®æ˜¯åœ¨å¾®ä¿¡å…¬ä¼—å·ä¸Šè·³è½¬åˆ°çš„WEBé¡µé¢ï¼Œåº†å¹¸çš„æ˜¯å¾®ä¿¡å…¬ä¼—å·å¼€å‘æˆ‘è¿˜æ˜¯æ¯”è¾ƒç†Ÿæ‚‰çš„ï¼Œå¯æ€•çš„æ˜¯ç”¨æˆ·å¼ºçƒˆè¦æ±‚ç”¨C#è¯­è¨€ï¼Œè¿è¡ŒçŽ¯å¢ƒæ˜¯Windows Server 2008 ã€IIS8ã€SQL Server 2008ï¼Œç”¨æˆ·æ•°é‡åœ¨500å·¦å³ã€‚å¥½å§æˆ‘æ‰¿è®¤æˆ‘æ²¡æœ‰åšè¿‡C#å¼€å‘ï¼Œä¸è¿‡è¿˜èƒ½å›žå¿†èµ·é¥è¿œçš„è¿‡åŽ»åœ¨å­¦æ ¡å­¦çš„ä¸€ç‚¹ç‚¹å¯èƒ½æœ‰ç”¨çš„çŸ¥è¯†ï¼Œå¯¹æˆ‘æ¥è¯´è¿™æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ï¼Œä¸è¿‡å¥½åœ¨ç”¨æˆ·æ•°é‡å¾ˆå°‘ï¼Œè¿™æ˜¯ä»–ä»¬å…¬å¸å†…éƒ¨å‘˜å·¥ç”¨çš„è½¯ä»¶ï¼ŒçœŸå®žå“”äº†ç‹—äº†ã€‚ éœ€æ±‚åˆ†æžæ ¹æ®å’Œå®¢æˆ·çš„å¯¹æŽ¥å†…å®¹ï¼Œå¤§æ¦‚æ˜¯æƒ³è¦ä¸€ä¸ªå‰ç«¯ç¨‹åºå’Œä¸€ä¸ªåŽå°ç®¡ç†ç³»ç»Ÿã€‚åŸºæœ¬åŠŸèƒ½ä¸ºç”¨æˆ·é€šè¿‡å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ä¹‹åŽå¯ä»¥ç‚¹å‡»é“¾æŽ¥è¿›å…¥åˆ°æ¸¸æˆä¸­å¿ƒã€‚å…¶ä¸­å‰ç«¯ä¸»è¦åŒ…å«ä»¥ä¸‹å››ä¸ªæ¨¡å—ï¼š çŽ‹è€…è®­ç»ƒåœºï¼šç”¨æˆ·å¹³å¸¸ç»ƒä¹ çš„åœºæ‰€ï¼Œæ¯é“é¢˜å›žç­”æˆåŠŸåŽä¼šèŽ·å¾—ç›¸åº”çš„åˆ†æ•°ã€‚ å…¨æ°‘PKï¼šç”¨æˆ·å’Œç”¨æˆ·ä¹‹é—´PKçš„åœºæ‰€ï¼Œé‡Œé¢åŒ…æ‹¬å®žæ—¶PKå’Œç¦»çº¿PKã€‚ ä¸ªäººä¸­å¿ƒï¼šå¯ä»¥æŸ¥çœ‹è‡ªå·±çš„åŸºæœ¬èµ„æ–™å’Œå¾—åˆ†æƒ…å†µã€‚ æŽ’è¡Œæ¦œï¼šå¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„æŽ’è¡Œæƒ…å†µä»¥åŠè‡ªå·±çš„å‘¨æŽ’åå’ŒæœˆæŽ’åã€‚ åŽå°ä¸»è¦åŒ…å«ä»¥ä¸‹å››ä¸ªæ¨¡å—ï¼š é¢˜åº“ç®¡ç†ï¼šç”¨æˆ·å¯ä»¥æŸ¥çœ‹å’Œç¼–è¾‘é¢˜åº“ã€‚ å¹¿å‘Šç®¡ç†ï¼šæ‰€è°“çš„å¹¿å‘Šå°±æ˜¯ç”¨æˆ·åœ¨ç­”é¢˜ä¸ªè¿‡ç¨‹ä¸­ï¼Œåœ¨é¢˜ç›®ä¸‹å‘ä¼šæ˜¾ç¤ºä¸€è¡Œæ–‡å­—å¹¿å‘Šã€‚è¿™é‡Œå¯ä»¥ç¼–è¾‘å¹¿å‘Šå†…å®¹ã€‚ ç”¨æˆ·ç®¡ç†ï¼šç®¡ç†å‚ä¸Žç­”é¢˜çš„ç”¨æˆ·å’ŒæŸ¥çœ‹ç­”é¢˜æƒ…å†µï¼Œå¹¶æ¯æœˆæˆ–è€…æ¯å‘¨æå–å‰20åè¿›è¡Œçº¿ä¸‹å¥–åŠ±ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è¿›è¡ŒæŒ‰æœˆæˆ–è€…æŒ‰å‘¨æŽ’åºã€‚ PKç®¡ç†ï¼šæŸ¥çœ‹ç”¨æˆ·çš„PKæƒ…å†µä»¥åŠç”¨æˆ·åœ¨PKè¿‡ç¨‹ä¸­å‚ä¸Žç­”é¢˜çš„æƒ…å†µã€‚ æ ¹æ®ä»¥ä¸Šæè¿°å¤§æ¦‚æ•´ç†äº†ä¸¤ä¸ªå¯¹åº”çš„è„‘å›¾,æˆ‘æ˜¯ä¸šä½™çš„è¯·å¿½ç•¥ç¾Žè§‚æ€§ï¼š åŸºç¡€è®¾è®¡ å‰ç«¯ï¼šå¥½åœ¨å®¢æˆ·æä¾›å¾®ä¿¡ç«¯çš„è®¾è®¡å›¾ï¼ŒPSDæ ¼å¼çš„æ–‡ä»¶ã€‚æˆ‘ä»¬å¼€å‘è€…è‡ªå·±æ¥åˆ‡å›¾å³å¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±çœåŽ»äº†UIè®¾è®¡çš„æ—¶é—´ï¼Œæˆ‘ä»¬åªæ˜¯æ•°æ®çš„æ¬è¿å·¥ã€‚ åŽå°ï¼šåŽå°åªæœ‰ä¸€ä¸ªç®¡ç†å‘˜ç»´æŠ¤ï¼Œå¯¹UIè¦æ±‚ä¸é«˜ï¼Œæ–¹ä¾¿æ“ä½œå³å¯ï¼Œæˆ‘æƒ³è¿™æ˜¯å¤§éƒ¨åˆ†ç®¡ç†åŽå°çš„é€šç”¨æ¨¡å¼ã€‚ å¼€å‘çŽ¯å¢ƒï¼šå¥½å§ï¼Œæˆ‘åªæ˜¯iOSå¼€å‘è€…ï¼Œç”¨çš„æ˜¯MacProæˆ‘å°è¯•ç”¨Macç‰ˆæœ¬çš„Visual Studio,ä½†æ˜¯å®˜æ–¹ä¸Šé¢å¥½åƒå†™çš„æ˜¯æµ‹è¯•ç‰ˆæœ¬ï¼›è€Œä¸”Macç‰ˆæœ¬çš„ä¸»æ‰“.net core,å¯¹.net MVCå¹¶ä¸å‹å¥½è€Œä¸”å¯¹æ•°æ®åº“ä¹‹ç±»çš„æ“ä½œä¸å¤ªæ–¹ä¾¿ï¼›æœ€ä¸»è¦çš„æ˜¯IISçŽ¯å¢ƒã€‚å¥½å§æˆ‘æ”¾å¼ƒäº†Macç‰ˆæœ¬ã€‚what the f**k å®‰è£…VMware -&gt;Windows Server 2012-&gt;IIS8 -&gt;Microsoft Visual Studio,ðŸ˜“ðŸ˜“ðŸ˜“å¿™æ´»äº†ä¸€ä¸‹åˆç”šè‡³åŠ äº†ä¸ªç­ï¼Œåˆ›å»ºä¸ª.net MVCå¯ä»¥è·‘èµ·æ¥äº†ã€‚(æˆ‘æ²¡ç”¨.net core)çš„åŽŸå› ä¸»è¦æ˜¯å®¢æˆ·é‚£è¾¹æœ‰æŠ€æœ¯å›¢é˜Ÿåœ¨ç»´æŠ¤å¾®ä¿¡å…¬ä¼—å·ï¼Œç”¨çš„æ˜¯.net MVC,æˆ‘é¿å…æœ‰å‘ï¼Œæ‰€æœ‰æˆ‘ä¹Ÿç…§æ—§äº†ã€‚ æ•°æ®åº“ï¼šæ­¤å¤„çœç•¥ã€‚ å¼€å‘ä¸€ååŒäº‹åŠ å…¥äº†ï¼Œä»–è´Ÿè´£å¾®ä¿¡ç«¯æ‰€æœ‰çš„é¡µé¢ï¼Œå…¶ä½™çš„åŽå°å’ŒæŽ¥å£æˆ‘æ¥è´Ÿè´£ðŸ˜­ðŸ˜­ðŸ˜­ã€‚å•ªå•ªå•ªâ€¦å•ªå•ªå•ªâ€¦å•ªå•ªå•ªâ€¦æ’žå‡»å£°ä¼´éšç€åšå‡ºä¸œè¥¿çš„å¿«æ„Ÿâ€¦æ­¤å¤„çœç•¥500å­—â€¦ä¸€éåˆä¸€éçš„è°ƒè¯•ï¼Œç»ˆäºŽåŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œä¸¤ä¸ªå‘¨çš„æ—¶é—´æžå®šï¼Œå†…éƒ¨æµ‹è¯•é€šè¿‡ç”¨æˆ·æµ‹è¯•æ²¡å•¥é—®é¢˜ï¼ŒæŽ¥ä¸‹æ¥å°±æ˜¯è°ƒæ•´éœ€æ±‚äº†ðŸ˜†ðŸ˜†ðŸ˜†ðŸ˜†ï¼ˆæ­¤å¤„ä¸è®²äº†,ç”²æ–¹è¿˜æ˜¯é‚£ä¸ªç”²æ–¹ï¼‰ æŽ¥ä¸‹æ¥ä¸Šæ•ˆæžœ: åŽå°ï¼š.Net å‰ç«¯: éš¾ç‚¹æˆ‘è®¤ä¸ºæ­¤é¡¹ç›®çš„éš¾ç‚¹åœ¨äºŽPKæ¨¡å—ï¼Œç»è¿‡å¤šæ–¹æŸ¥é˜…èµ„æ–™ï¼Œä¹Ÿæ²¡æœ‰æ‰¾å‡ºä¸ªæ‰€ä»¥ç„¶æ¥ã€‚äºŽæ˜¯æˆ‘é‡‡å–äº†WebSocket + Timerçš„æ–¹å¼ï¼Œè¿™æ ·å¯¹äºŽ500å¤šç”¨æˆ·çš„åº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚WebSocket è´Ÿè´£ä¿æŒå’Œç”¨æˆ·é€šè®¯ï¼ŒTimeræ¯ç§’è´Ÿè´£å¾ªçŽ¯å¤„ç†ç”¨æˆ·çš„æ•°æ®ã€‚ 1.é¦–å…ˆåˆ›å»ºenum PKUserStatus ç”¨æ¥è¡¨ç¤ºç”¨æˆ·çš„å‡ ç§çŠ¶æ€,è¿™ä¸ªæžšä¸¾è¡¨ç¤ºä»Žç”¨æˆ·é“¾æŽ¥æˆåŠŸåˆ°PKç»“æŸçš„æ‰€æœ‰çŠ¶æ€: 12345678910111213141516171819202122232425262728293031323334353637383940414243public enum PKUserStatus &#123; /** * ç­‰å¾…åŒ¹é… */ WAIT_PAIR = 0, /**åŒ¹é…æˆåŠŸï¼Œç­‰å¾…å®¢æˆ·ç«¯ç¡®è®¤ */ WAIT_PAIR_SUCCESS, /**åŒ¹é…å¤±è´¥ï¼Œå¯èƒ½å‡†å¤‡å…³é—­è¿žæŽ¥ */ WAIT_PAIR_FAILURE, /**å®¢æˆ·ç«¯å·²ç»ç¡®è®¤ï¼Œç­‰å¾…æœåŠ¡ç«¯å‘é¢˜ */ WAIT_ISSUE, /**å‘é¢˜ */ ISSUE, /**ç­‰å¾…å®¢æˆ·ç«¯å›žç­” */ WAIT_ANSWER, /**èƒœåˆ© */ WIN, /**å¤±è´¥ */ FAIL, /**æ— æ•ˆ */ INVALID, /**å¹³å±€ */ //DRAW,&#125; 2.åˆ›å»ºUserç±»:åŸºæœ¬çš„ç”¨æˆ·å¯¹è±¡ 123456789101112131415161718192021public class PKUser&#123; //è¿›å…¥ç³»ç»Ÿæ—¶é—´ public DateTime connectTime &#123; get; set; &#125; //userId public int userId &#123; get; set; &#125; //ç”¨æˆ·å½“å‰çš„çŠ¶æ€ private PKUserStatus __status &#123; get; set; &#125; //å›žç­”é¢˜ç›®ç´¯è®¡ç”¨æ—¶ public int answerTime &#123; get; set; &#125; //æ­£åœ¨è¿žæŽ¥çš„socket public WebSocket webSocket &#123; get; set; &#125; //... æ ¹æ®éœ€è¦çš„å‚æ•°æˆ–è€…æ–¹æ³• ...//&#125; 3.åˆ›å»ºPKContextç±»:ç±»ä¼¼äºŽæˆ¿é—´çš„æ¦‚å¿µï¼Œæ¯ä¸ªPKContextè¡¨ç¤ºä¸€ä¸ªPKåœºæ¬¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950 public class PKContext&#123; //å½“å‰PKæ‰€éœ€è¦å›žç­”çš„é¢˜ç›® private List&lt;question_info_vo&gt; questions &#123; get; set; &#125; //å½“å‰æ­£åœ¨å›žç­”çš„é¢˜ç›®ï¼Œå›žç­”è§„åˆ™æ˜¯åŒæ–¹åŒæ—¶èŽ·å¾—æ–°é¢˜ç›®ï¼Œå¦‚æžœä¸€æ–¹å›žç­”å®Œï¼Œåˆ™ä¼šç­‰å¾…å¦ä¸€æ–¹å›žç­”ç»“ æŸæ‰ä¼šæœ‰æ–°çš„è¯•é¢˜ã€‚ private int currentIndex = 0; //ä»…æ”¯æŒ2äººpk,æ‰€ä»¥è¿™é‡Œç›´æŽ¥å®šä¹‰äº†ä¸¤ä¸ªuserå¯¹è±¡ public PKUser user1 &#123; get; set; &#125; public PKUser user2 &#123; get; set; &#125; //èŽ·å–ä¸‹ä¸€é“è¯•é¢˜ï¼Œå¦‚æžœå·²ç»ä¸ºæœ€åŽä¸€é“ï¼Œåˆ™è¿”å›žnull public question_info_vo nextQuestion() &#123; if (currentIndex &lt; questions.Count()) &#123; return questions[currentIndex++]; &#125; return null; &#125; //ä¿å­˜pkä¿¡æ¯ private void insertPKInfo() &#123; //... &#125; //ç»“ç®—åˆ†æ•° public void insertUserScore() &#123; //... &#125; //ç”¨æˆ·ç­”é¢˜ public void answers(PKUser user, Dictionary&lt;string, object&gt; options) &#123; //... &#125; public int score(PKUserStatus staus) &#123; return 0; &#125; //... å…¶ä»–æ–¹æ³• ...//&#125; 4.æŽ¥ä¸‹æ¥çš„æµç¨‹æŽ§åˆ¶åœ¨æŽ§åˆ¶å™¨å®žçŽ°å³å¯: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155public class WSChatController : ApiController&#123; /** * ç”¨æˆ·è¿žæŽ¥æ± ï¼Œç­‰å¾…åŒ¹é…çš„ç”¨æˆ·ï¼Œæ²¡æœ‰åŒ¹é…çš„ç”¨æˆ·åœ¨è¿™é‡Œæš‚å­˜ï¼Œ * æœ€å¤§å­˜æ´»60sï¼Œè¿‡æœŸåŽæœåŠ¡å™¨å³æ–­å¼€æ­¤ç”¨æˆ·çš„é“¾æŽ¥ */ private static List&lt;PKUser&gt; USER_POOL = new List&lt;PKUser&gt;(); /** * ç”¨æˆ·pkæ± ï¼Œæ­£åœ¨è¿›è¡Œçš„pkä¿å­˜åœ¨è¿™é‡Œï¼Œ * pkç»“æŸåŽéœ€è¦ç§»é™¤ */ private static List&lt;PKContext&gt; PK_POOL = new List&lt;PKContext&gt;(); /** * è®¡æ—¶å™¨,æ¯éš”1sä¸­ä¼šè½®è¯¢å„ä¸ªçŠ¶æ€çš„ç”¨æˆ·ï¼ŒåŒæ—¶ä¼šå‘ç”¨æˆ·å‘é€å“åº”çš„æ•°æ® * å¼Šç«¯åœ¨äºŽå®šæ—¶å¯èƒ½ä¼šä¸å¤ªç²¾ç¡®ï¼Œæˆ–è€…åœ¨å›žè°ƒå‡½æ•°é‡Œé¢æ“ä½œè€—æ—¶çš„åŠ¨ä½œä¼šå½±å“ä¸šåŠ¡æµç¨‹ï¼Œ * ä¸è¿‡å¯¹äºŽæœ¬ç³»ç»Ÿç»°ç»°æœ‰ä½™äº† */ private static Timer timer = new Timer(new TimerCallback(timerCallback), null, 1000, 1000); public HttpResponseMessage Get() &#123; if (HttpContext.Current.IsWebSocketRequest) &#123; HttpContext.Current.AcceptWebSocketRequest(ProcessWSChat); &#125; return new HttpResponseMessage(HttpStatusCode.SwitchingProtocols); &#125; private async Task ProcessWSChat(AspNetWebSocketContext arg) &#123; WebSocket socket = arg.WebSocket; int userId = int.Parse(arg.QueryString[&quot;user&quot;].ToString()); //... æ­¤å¤„éœ€è¦åˆ¤æ–­userIdçš„æœ‰æ•ˆæ€§ï¼Œå¿½ç•¥ ...// try &#123; //æ–°è¿žæŽ¥ï¼Œæ·»åŠ åˆ°è¿žæŽ¥æ± é‡Œ USER_POOL.Add(new PKUser(/*æž„é€ å‡½æ•°*/)); while (true) &#123; if (socket.State == WebSocketState.Open) &#123; ArraySegment&lt;byte&gt; buffer = new ArraySegment&lt;byte&gt;(new Byte[2048]); WebSocketReceiveResult result = await socket.ReceiveAsync(buffer, CancellationToken.None); //æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯æ¶ˆæ¯åŽï¼Œä¼šç»§ç»­å¾€ä¸‹èµ° try &#123; if (socket.State != WebSocketState.Open) &#123; //åˆ¤æ–­å®¢æˆ·ç«¯çš„çŠ¶æ€æ˜¯å¦ä¸æ˜¯é“¾æŽ¥çŠ¶æ€ï¼Œå¦åˆ™ä¼šèµ°æ–­å¼€ç”¨æˆ·çš„æ–¹æ³• offline(userId); break; &#125; string userMsg = Encoding.UTF8.GetString(buffer.Array, 0, result.Count); Dictionary&lt;string, object&gt; json = new JavaScriptSerializer().Deserialize&lt;Dictionary&lt;string, object&gt;&gt;(userMsg); //æ­¤å¤„ä¼šæ”¶é›†åˆ°å®¢æˆ·ç«¯çš„jsonæ•°æ®ï¼Œ //... æ ¹æ®æ•°æ®æ‰§è¡Œç›¸åº”çš„æ“ä½œ ...// &#125; catch (Exception e) &#123; &#125; &#125; else &#123; //å¦‚æžœç”¨æˆ·ä¸æ˜¯é“¾æŽ¥çŠ¶æ€ï¼Œæ‰§è¡Œæ–­å¼€é“¾æŽ¥æ–¹æ³• offline(userId); break; &#125; //è®©cpuä¼‘æ¯100æ¯«ç§’,å¯¹cpuæ¥è¯´100æ¯«ç§’å·²ç»æ˜¯å¾ˆé•¿æ—¶é—´äº† Thread.Sleep(100); &#125; &#125; catch (Exception e) &#123; offline(userId); &#125; &#125; /** * å®šæ—¶å™¨å›žè°ƒå‡½æ•° */ private static void timerCallback(Object obj) &#123; Dictionary&lt;string, object&gt; msg_dic = new Dictionary&lt;string, object&gt;(); string time = timestamp(); List&lt;PKUser&gt; removeUser = new List&lt;PKUser&gt;(); /** * å¤„ç†æ²¡æœ‰åŒ¹é…çš„User */ for (int i = 0; i &lt; USER_POOL.Count(); i++) &#123; //åœ¨æ­¤å¤„éåŽ†ç­‰å¾…åŒ¹é…çš„User,å¯ä»¥æŒ‰ç…§è§„åˆ™è¿›è¡ŒuseråŒ¹é…ï¼Œ //æˆ–è€…ç§»é™¤è¶…æ—¶çš„user,è¿‡ç¨‹å¿½ç•¥ //è¿˜å¯ä»¥åœ¨è¿™é‡Œç»™å®¢æˆ·ç«¯å‘é€è‡ªå®šä¹‰å¿ƒè·³åŒ… &#125; /** * å¤„ç†åŒ¹é…æˆåŠŸçš„User */ foreach (PKContext context in PK_POOL) &#123; if (context.user1.status == PKUserStatus.WAIT_PAIR_SUCCESS) //åœ¨æ­¤å¤„åˆ¤æ–­æ­£åœ¨pkçš„ç”¨æˆ·çŠ¶æ€ï¼Œç„¶åŽæ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡æµç¨‹å³å¯,è¿‡ç¨‹å¿½ç•¥ &#125; &#125; /** * ç”¨æˆ·æŽ‰çº¿ */ private static void offline(int userId) &#123; //ç”¨æˆ·æ–­çº¿, //éœ€è¦æ¸…ç©ºç”¨æˆ·æ•°æ®ç­‰æ“ä½œï¼Œæ¯”å¦‚USER_POOLã€PK_POOL &#125; /** * æœåŠ¡å™¨ä¸»åŠ¨æ–­å¼€é“¾æŽ¥å‘é€close */ private static ArraySegment&lt;byte&gt; closeBuffer = new ArraySegment&lt;byte&gt;(new byte[2] &#123; 0x88, 0x00 &#125;); private static void sendClose(WebSocket socket) &#123; //socket.CloseAsync(WebSocketCloseStatus.NormalClosure,&quot;websocket closed for server&quot;,CancellationToken.None); sendBuffer(socket, closeBuffer); &#125; //... å…¶ä»–æ–¹æ³• ...//&#125; ç»“è¯­å†™åˆ°æ­¤å¤„åŸºæœ¬ä¸Šç®—æ˜¯å¯¹è¿™ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†æžæ˜Žç™½äº†ï¼ˆè¯·åŽŸè°…å…·ä½“å®žçŽ°æ²¡æœ‰å†™å‡ºæ¥ï¼‰,è‡³äºŽåˆ«çš„æŽ¥å£ã€å‰ç«¯é¡µé¢ã€æ•°æ®åº“ä¹‹ç±»çš„å°±ä¸å™è¿°äº†ï¼Œåœ¨ç®€å•ä¸è¿‡äº†ã€‚æœ€åŽåœ¨åæ§½ä¸€ä¸‹è¿™ä¸ªpkçš„æ–¹æ¡ˆçœŸçš„æ˜¯å¤ªlowäº†ï¼Œä¸è¿‡çŽ°åœ¨è·‘è¿™ä¸ªç³»ç»ŸåŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆé—®é¢˜ã€‚å¦‚æžœç”¨æˆ·é‡æ¯”è¾ƒå¤§æˆ–è€…è¦æ±‚æ›´é«˜çš„è¯ä¸å»ºè®®è‡ªå·±å†™pkå¯¹æˆ˜ç³»ç»Ÿï¼Œæœ€å¥½ä½¿ç”¨å•†ä¸šçš„æœåŠ¡å¼•æ“Žï¼Œæ¯”å¦‚matchvså°±ä¸é”™å“¦ï¼]]></content>
  </entry>
  <entry>
    <title><![CDATA[KSThumbImage(ä¸€)]]></title>
    <url>%2F2018%2FKSThumbImage%2F</url>
    <content type="text"><![CDATA[æˆ‘ä»¬ä¸ç ”ç©¶SDWebImageçš„æºç ï¼Œè‡ªå·±æ¥å†™ä¸€ä¸ªçš„èŽ·å–è§†é¢‘ç¼©ç•¥å›¾çš„ç½‘ç»œæ¡†æž¶ã€‚]]></content>
  </entry>
  <entry>
    <title><![CDATA[ç¨‹åºå‘˜çš„è®¨è–ªä¹‹è·¯]]></title>
    <url>%2F2018%2F%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%AE%A8%E8%96%AA%E4%B9%8B%E8%B7%AF%2F</url>
    <content type="text"><![CDATA[ç§èŠ ### å‰è¨€æˆ‘ä¼°è®¡ä½œä¸ºç å†œæ¥è¯´æ¯”è¾ƒæ‚²å‚¬çš„æ˜¯æŠŠå…¬å¸å¹²å€’é—­ï¼Œè€Œæœ€æ‚²å‚¬çš„æ˜¯å€’é—­çš„å…¬å¸è¿˜æ¬ ç€å·¥èµ„ï¼Œè¿™å¯å’‹åŠžå‘¢ï¼Ÿåœ¨è¿™é‡Œæˆ‘è®°å½•ä¸€ä¸‹æˆ‘è‡ªå·±è®¨è¦å·¥èµ„çš„è‰°è¾›ä¹‹è·¯ï¼š### èƒŒæ™¯å…¬å¸åç§°: åŒ—äº¬XXXç§‘æŠ€æœ‰é™å…¬å¸å…¬å¸ä½æ‰€: åŒ—äº¬å¸‚ä¸°å°åŒºXXX(è¿™ä¸ªæ˜¯è™šæ‹Ÿåœ°å€)åˆåŒå±¥è¡Œåœ°ï¼šåŒ—äº¬å¸‚æœé˜³åŒºXXXï¼ˆä¸Šç­çš„åœ°æ–¹ï¼Œå°±æ˜¯åŠ³åŠ¡åˆåŒä¸Šé¢å†™çš„åœ°å€ï¼‰### ç»è¿‡2017å¹´12æœˆ28å·ï¼Œæ€»ç›‘ç»™æˆ‘ä»¬æ‰€æœ‰äººå¼€äº†ä¸€ä¸ªå°ä¼šï¼Œä¼šè®®ä¸»é¢˜å°±æ˜¯å…¬å¸é©¬ä¸Šå‡†å¤‡è§£æ•£äº†ï¼Œå¤§å®¶åšå¥½å¿ƒç†å‡†å¤‡ï¼Œbulabulaç­‰ç­‰ä¸€å¤§å †ã€‚æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯12æœˆä»½çš„å·¥èµ„åŽŸæœ¬åº”è¯¥åœ¨1æœˆ15å·å‘ï¼Œä½†æ˜¯æ€»ç›‘è¯´å¯èƒ½å¾—å»¶è¿Ÿï¼Œå…¬å¸ä¼šç»™æ‰“æ¬ æ¡ï¼Œæˆ‘ä»¬å½“ç„¶ä¸åŒæ„äº†ï¼Œä½†æ˜¯åˆæœ‰ä»€ä¹ˆåŠžæ³•å•Šï¼Œä»Šå¤©çš„ä¼šè®®åˆ°æ­¤å°±ç»“æŸäº†ã€‚2017å¹´12æœˆ31å·ï¼Œä»Šå¤©æ˜¯æœ€åŽä¸€å¤©äº†ï¼Œä¸‹å®Œç­åŽå…¬å¸æ²¡è®©å‘˜å·¥èµ°ï¼Œå°±æ˜¯æ‰§è¡Œ12æœˆ28å·çš„ä¼šè®®å†…å®¹ï¼Œç»™æ¯ä¸ªå‘˜å·¥ç­¾è®¢ç¦»èŒè¯æ˜Žï¼Œæ¬ æ¬¾å€Ÿæ¡å¹¶ä¸”è¿˜çº¦å®šåˆ©æ¯,çº¦å®š1æœˆä»½çš„å·¥èµ„åœ¨3æœˆ15å·ä¹‹å‰å‘ä¸‹æ¥ï¼ˆçŽ°åœ¨æƒ³æƒ³è¿™å¤©æˆ‘å°±æ˜¯ä¸ªå‚»å­ï¼Œåƒäº†ç‹—å±Žäº†ï¼Œäº‹å®žè¯æ˜Žä»Šå¤©æ˜¯çœ‹è§æ³•äººçš„æœ€åŽä¸€å¤©ï¼‰ã€‚æ—¶é—´ä¸€åˆ†ä¸€ç§’çš„è¿‡åŽ»äº†â€¦### åŠ³åŠ¨ä»²è£2018å¹´3æœˆ15æ—¥åˆ°äº†ï¼Œæœ¬æ¥è¯¥æ˜¯æ‰“å‡çš„å¥½æ—¥å­ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ²¡æœ‰ç­‰æ¥è¯¥ç»™çš„å·¥èµ„ã€‚æ²¡æœ‰åŠžæ³•å•Šï¼Œå‡†å¤‡ä»²è£å§ã€‚å…¶å®žæˆ‘å¯¹åŠ³åŠ¨ä»²è£æ²¡ä»€ä¹ˆæ¦‚å¿µï¼Œå°±æ˜¯åœ¨æ­¤æ—¶æ¶è¡¥ä¸€äº›æ³•å¾‹çŸ¥è¯†ï¼Œä»²è£æœºæž„ä¹‹ç±»çš„ï¼Œè¿˜åŽ»å’¨è¯¢è¿‡å¾‹å¸ˆã€‚å¾‹å¸ˆä¹Ÿå»ºè®®æˆ‘ç”³è¯·åŠ³åŠ¨ä»²è£ã€‚è¯´åˆ°å¾‹å¸ˆè¿™å—å¯¹äºŽåŠ³åŠ¨ä»²è£çš„è¯ï¼Œå’¨è¯¢å¾‹å¸ˆæ˜¯ä¸æ”¶å¾‹å¸ˆè´¹ç”¨çš„ã€‚éšä¾¿åœ¨ç½‘ä¸Šæ‰¾ä¸ªå¾‹å¸ˆç»“æž„ï¼Œç„¶åŽä¼šæœ‰äººä¸»åŠ¨çº¦ä½ åŽ»èŠï¼ŒåŸºæœ¬ä¸Šå…è´¹,ä½†ä»…ä»…æ˜¯å’¨è¯¢ï¼Œè‡³äºŽä»£ç†å¾—è¦æ”¶è´¹äº†ã€‚å¯¹äºŽåˆ«çš„ç»æµŽçº çº·æˆ‘ä¼°è®¡å°±æ²¡é‚£ä¹ˆå¥½çš„å¾…é‡äº†ã€‚å› ä¸ºå…¬å¸çš„ä½æ‰€æ˜¯åœ¨ä¸°å°åŒºï¼Œæ‰€ä»¥æˆ‘éœ€è¦åŽ»ä¸°å°åŒºçš„åŠ³åŠ¨ä»²è£å§”å‘˜ä¼šåŽ»ç”³è¯·ã€‚å½“ç„¶åœ¨åŠ³åŠ¨çš„å±¥è¡Œåœ°â€”â€”æœé˜³åŒºä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯äººå®¶å»ºè®®æˆ‘åŽ»ä½æ‰€åœ°ï¼Œå› ä¸ºè¿™æ ·çš„è¯å‡ºç»“æžœä¼šå¿«ç‚¹ã€‚åœ¨åŽ»ä¸°å°åŒºçš„åŠ³åŠ¨ä»²è£å§”å‘˜ä¼šç”³è¯·åŠ³åŠ¨ä»²è£ä¹‹å‰æˆ‘æ˜¯å……åˆ†çš„äº†è§£åˆ°éœ€è¦å¸¦ä»€ä¹ˆææ–™ï¼Œå› ä¸ºæˆ‘æ€•å¤šè·‘å†¤æž‰è·¯ã€‚å¤§æ¦‚äº†è§£åˆ°éœ€è¦ä»¥ä¸‹ææ–™:1. èº«ä»½è¯åŽŸä»¶å’Œå¤å°ä»¶;2. ä¼ä¸šä¿¡ç”¨æŠ¥å‘Š;åŽ»æ­¤å¤„æ‰“å°ï¼Œåœ¨ä¸Šé¢æœç´¢ä½ çš„å…¬å¸ï¼Œæœå‡ºç»“æžœåŽæ‰“å°å‡ºæ¥èµ„æ–™å³å¯;2. ç”³è¯·ä¹¦åŽŸä»¶å’Œ3ä»½å¤å°ä»¶;3. é€è¾¾åœ°å€ç¡®è®¤ä¹¦;4. è¯æ®ææ–™æ¸…å•+å„ç§è¯æ®å’Œ3ä»½å¤å°ä»¶,åœ¨åŽ»ä¹‹å‰æˆ‘åªæ‰“å°äº†2ä»½å¤å°ä»¶,å®³å¾—æˆ‘åœ¨çŽ°åœºè€—èµ„60å…ƒåœ¨å¤å°ä¸€ä»½;æŸ¥çœ‹æœ‰æ•ˆçš„è¯æ®;5. å…¬å¸çš„åŠžå…¬åœ°ç‚¹è§†é¢‘èµ„æ–™ï¼Œè¿™ä¸ªçœ‹å…·ä½“æƒ…å†µã€‚æˆ‘å…¬å¸æ˜¯å› ä¸ºåŠžå…¬åœ°ç‚¹è§£æ•£äº†ï¼Œå°±æ˜¯è¯´æ²¡æœ‰äº†åŠžå…¬åœ°å€ï¼Œæ‰€ä»¥ä»²è£å§”è®©æˆ‘åŽ»æ‹ä¸å†åŠžå…¬çš„è¯æ®ã€‚æˆ‘å°±ç”¨æ‰‹æœºæ‹å‡ ä¸ªè§†é¢‘åŽåˆ»å½•åœ¨å…‰ç›˜ä¸Šè¡¥äº¤äº†ä¸ŠåŽ»ã€‚å½“ç„¶å¦‚æžœå…¬å¸è¿˜åœ¨åŠžå…¬ï¼Œå°±æ˜¯è¯´ä»²è£å§”èƒ½è”ç³»ä¸Šå…¬å¸çš„è¯è¿™ä¸ªè¯æ®å¯ä¸ç”¨æäº¤ã€‚ä»¥ä¸Šææ–™çš„æ¨¡æ¿åœ¨æ­¤å¤„ä¸‹è½½2018å¹´4æœˆ4å·ï¼Œä¸€åˆ‡å‡†å¤‡å¥½ä¹‹åŽï¼Œæˆ‘ç›´æŽ¥åŽ»äº†ä¸°å°åŒºåŠ³åŠ¨äººäº‹äº‰è®®ä»²è£é™¢ï¼ˆåŒ—äº¬å¸‚ä¸°å°åŒºå—ä¸‰çŽ¯è¥¿è·¯91å·é™¢å®éš†å¤§åŽ¦ï¼‰æäº¤äº†ä¸Šè¿°1ã€2ã€3ã€4èµ„æ–™ã€‚è‡³äºŽ5çš„è¯ï¼Œåˆšæ‰è¯´äº†æ˜¯åŽè¡¥äº¤ä¸Šçš„ã€‚æ—¶é—´åœ¨æµå¤±â€¦2018å¹´4æœˆ10å·ï¼Œç»ˆäºŽæœ‰æ¶ˆæ¯äº†ï¼Œè¿™å¤©æœ‰ä¸ªç”µè¯æ‰“ç»™æˆ‘è¯´ä½ çš„æ¡ˆå­å·²ç»ç«‹äº†ï¼Œæœ‰ä»€ä¹ˆäº‹ç›´æŽ¥ç»™æˆ‘æ‰“ç”µè¯å°±è¡Œã€‚è€Œä¸”è¿˜ç‰¹æ„é‡é‡çš„å¤è¿°äº†ä¸€éï¼Œææ€•æˆ‘ä¸çŸ¥é“å•¥æ„æ€çš„ä¼¼çš„ï¼šâ€œè¿™æ¬¡æˆ‘æ‰“ç”µè¯æ˜¯å‘Šè¯‰ä½ çš„æ¡ˆå­å·²ç»ç«‹äº†â€ã€‚æŽ¥ä¸‹æ¥æ˜¯ç­‰å¾…â€¦2018å¹´4æœˆ12å·ï¼Œé‚£ä¸ªä»²è£å‘˜åˆç»™æˆ‘æ‰“ç”µè¯äº†ï¼Œè¯´å…¬å¸æ³•äººè”ç³»ä¸ä¸Šï¼Œä½ éœ€è¦æä¾›åŠžå…¬åœ°å€çš„è§†é¢‘èµ„æ–™ï¼Œè€Œä¸”æ˜¯æä¾›åŠžå…¬åœ°å€å’Œä½æ‰€åœ°å€çš„ä¸¤ä¸ªè§†é¢‘ã€‚å°±æ˜¯ä¸Šé¢å¼€å§‹è¯´çš„ç¬¬5å·èµ„æ–™,-_-||ä½ ä»¬æ˜¯åšä»€ä¹ˆçš„ï¼Œè¿™äº›éœ€è¦æˆ‘åŽ»æ‹å—ã€‚å‘åŠ¿åŠ›ä½Žå¤´ï¼Œè·‘äº†ä¸¤ä¸ªåœ°æ–¹æ‹äº†è§†é¢‘ï¼Œè€—èµ„18å…ƒä¹°äº†ä¸ªå…‰ç›˜ï¼Œä¿å­˜åœ¨å…‰ç›˜ä¸Šâ€¦2018å¹´4æœˆ16å·ï¼ŒåˆåŽ»äº†ä»²è£é™¢é€äº†å…‰ç›˜ã€‚åˆæ˜¯å¯æ¶ç­‰å¾…â€¦2018å¹´5æœˆ15æ—¥ï¼Œè¿™ä¸ªæ—¶é—´æœ‰ç‚¹é•¿ï¼Œä¸­é—´å¿«æœ‰ä¸€ä¸ªæœˆçš„æ—¶é—´äº†ï¼Œä»²è£å‘˜é€šçŸ¥æˆ‘å‡†å¤‡å¼€åº­äº†ï¼ŒåŽ»é¢†å¼€åº­é€šçŸ¥ä¹¦ã€‚å¿ƒé‡Œæœ‰ç‚¹æ¿€åŠ¨ï¼Œç»ˆäºŽæœ‰ç‚¹çœ‰ç›®äº†ã€‚å½“å¤©ä¸‹åˆå°±åŽ»é¢†å›žæ¥äº†ï¼Œå¼€åº­é€šçŸ¥ä¹¦ä¸Šé¢å†™äº†ä¸€äº›æ³¨æ„äº‹é¡¹å’Œå¼€åº­æ—¶é—´ã€‚è‡³äºŽè¿™ä¸ªé—®ä»€ä¹ˆè¿™ä¹ˆé•¿ï¼Œä¸»è¦æ˜¯å› ä¸ºä»–ä»¬è”ç³»ä¸ä¸Šå…¬å¸ï¼Œä»–ä»¬åªå¥½æŠŠè¿™ä¸ªé€šçŸ¥ä¹¦å‘å…¬å‘Šäº†ï¼Œå°±æ˜¯åœ¨ã€Šå·¥äººæ—¥æŠ¥ã€‹ä¸Šé¢ã€‚ç­‰åˆ°å…¬å‘Šæ—¶é—´åˆ°äº†ï¼Œå°±ç›¸å½“äºŽå…¬å¸é»˜è®¤é¢†å–äº†ï¼Œæ‰å¼€å§‹ä¸‹ä¸€æ­¥ã€‚å½“ç„¶å¦‚æžœè”ç³»ä¸Šäº†å…¬å¸çš„è¯ï¼Œä¼°è®¡æ²¡é‚£ä¹ˆé•¿æ—¶é—´ã€‚2018å¹´8æœˆ12æ—¥ï¼ŒæŒ‰ç…§å¼€åº­é€šçŸ¥ä¹¦ä¸Šé¢çš„æ—¶é—´ï¼Œè¿™å¤©æ—©æ—©æ¥åˆ°ä»²è£é™¢ç­‰åˆ°äº†9ï¼š30ç»ˆäºŽå¼€å§‹äº†ï¼Œä¸æ˜¯è¯´9ç‚¹çš„å—??????æ³¨æ„ï¼šè¿™å¤©ä¸€å®šè¦å¸¦ä¸Šè¯æ®åŽŸä»¶ï¼Œåœ¨æ³•åº­ä¸Šä»²è£å‘˜ä¼šæ ¸æŸ¥çš„ã€‚ä¸ç„¶ç­‰åˆ°äººå®¶è¯´ä½ â€œè¯æ®éƒ½ä¸å¸¦ï¼Œä½ æ˜¯æ¥å¹²å˜›çš„â€é‚£å°±å°´å°¬äº†ã€‚åœ¨æ³•åº­ä¸Šï¼Œä»²è£å‘˜ã€æ–‡ä¹¦ã€æˆ‘ä¸‰ä¸ªäººï¼Œå…¬å¸æ²¡äººåŽ»å±žäºŽç¼ºå¸­è£å†³ã€‚åŸºæœ¬æµç¨‹å°±æ˜¯å¼€å§‹æˆ‘è®²ä¸€ä¸‹ç»è¿‡ï¼Œç„¶åŽä»²è£å‘˜é—®äº›åŸºæœ¬é—®é¢˜ï¼Œæ¯”å¦‚ä½ æ˜¯XXXå—ï¼Ÿè®²ä¸€ä¸‹ä½ çš„æƒ…å†µå•¦ï¼Ÿä½ è¿™ä¸ªè¯æ®æƒ³è¯æ˜Žä»€ä¹ˆå‘€ï¼Ÿç­‰ç­‰ã€‚æœ‰ä¸ªé—®é¢˜é—®çš„ç›¸å¯¹ç»†ä¸€äº›ï¼Œå°±æ˜¯é‚£ä¸ªç»ˆæ­¢åŠ³åŠ¨åˆåŒæ˜¯æ€Žä¹ˆç»ˆæ­¢çš„ï¼Ÿæœ‰æ²¡æœ‰å…·ä½“çš„è¯æ®ï¼Ÿå› ä¸ºæˆ‘è¦æ±‚çš„èµ”å¿ä¸Šé¢æœ‰åŠä¸ªæœˆçš„å·¥èµ„ï¼Œæ‰€ä»¥è¿™ä¸ªé—®çš„æ¯”è¾ƒæ·±ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰å®žè´¨çš„è¯æ®2017å¹´12æœˆ28å·é‚£å¤©åªæ˜¯å£å¤´æè¿°çš„ï¼Œè€Œä¸”åœ¨2017å¹´12æœˆ31å·é‚£å¤©è¿˜ç­¾äº†é‚£å‡ ä¸ªåè®®ï¼Œæ‰€ä»¥æˆ‘ä¼°è®¡è¿™ä¸ªåŠæœˆçš„èµ”å¿æ²¡æˆäº†å§ï¼Œæ–‡ä¹¦é‚£ä¹ˆåªè´Ÿè´£è®°å½•æˆ‘ä»¬çš„è°ˆè¯è®°å½•ã€‚æ•´ä¸ªè¿‡ç¨‹ä»²è£å‘˜çš„è¯­é€Ÿå¾ˆå¿«ï¼Œå¿«åˆ°æˆ‘éœ€è¦ä»”ç»†å›žæƒ³ä¸€ä¸‹æ‰èƒ½å¬åˆ°ä»–è¯´çš„ä»€ä¹ˆæ„æ€ðŸ˜†ï¼Œä¼°è®¡éƒ½æ˜¯å›ºå®šæµç¨‹ï¼Œæ€»ä½“ç®—ä¸‹æ¥ä¸åˆ°ååˆ†é’Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆå¿«å°±è§£å†³äº†ã€‚æœ€åŽç»“æŸçš„æ—¶å€™è¿˜æ˜¯é‚£å¥è¯ï¼Œå›žåŽ»ç­‰é€šçŸ¥ï¼Œæœ‰é—®é¢˜ç»™å¥¹æ‰“ç”µè¯ä¹‹ç±»ã€‚2018å¹´8æœˆ22å·,ç”µè¯é€šçŸ¥æˆ‘è£å†³ä¹¦ä¸‹æ¥äº†ï¼Œè®©æˆ‘åŽ»é¢†ã€‚2018å¹´8æœˆ23å·,æˆ‘å¸¦ç€èº«ä»½è¯åŽ»é¢†å›žæ¥äº†ä»²è£ä¹¦å’Œä¸€ä¸ªé€è¾¾å›žè¯è¿™ã€‚ä»–ä»¬å‘Šè¯‰æˆ‘è¿™ä¸ªé€è¾¾å›žè¯å¯ä»¥ä¸Šè¯‰ç”¨ã€‚ä»²è£ç»“æžœå°±æ˜¯è¦æ±‚å…¬å¸ä¸‹å‘1æœˆä»½çš„å·¥èµ„å’Œè¿™æœŸé—´çš„åˆ©æ¯ï¼Œé©³å›žäº†åŠä¸ªæœˆçš„èµ”å¿ã€‚å…¬å¸çš„ä»²è£ä¹¦åˆæ˜¯å‘å…¬å‘Šäº†ï¼ŒæŒ‡å®š60å†…æ¥é¢†å–ï¼Œå¦‚æžœä¸é¢†çš„è¯å°±ç›¸å½“äºŽé»˜è®¤é¢†å–ã€‚ä»²è£è¿™ä¸€æ­¥ä¼°è®¡å°±è¿™æ ·ç»“æŸäº†â€¦è¿˜æ˜¯ç­‰å¾…ï¼Œè¿™æ•ˆçŽ‡â€¦ç­‰äº†è¿™ä¹ˆå¤šå¤©ï¼Œè¿˜æ˜¯å®‰é™çš„è¿‡åŽ»äº†â€¦### ç”³è¯·æ‰§è¡Œå¼€å§‹æˆ‘åŽ»æœé˜³æ³•åº­ç”³è¯·,äººå®¶è¯´ä½ ä»²è£åœ¨ä¸°å°ä¸ºå•¥è¦æ¥æœé˜³å•Šï¼Œæˆ‘è¯´æˆ‘åŠ³åŠ¡åˆåŒåœ¨æœé˜³ã€‚ä»–çœ‹äº†çœ‹è¯´æˆ‘ä»¬å¿«ä¸‹ç­äº†ï¼Œä½ æ˜Žå¤©å†æ¥å§ï¼Œæˆ–è€…ç›´æŽ¥åŽ»ä¸°å°æ³•é™¢ï¼Œæœé˜³çš„å¤ªå¤šäº†æŽ’é˜Ÿå¾—å¾ˆé•¿æ—¶é—´,æ‰åˆšè¿‡4ç‚¹ä½ ä»¬å°±è¦ä¸‹ç­äº†ï¼Œæˆ‘èƒ½è¯´ä»€ä¹ˆï¼Œã€‚2018å¹´10æœˆ26æ—¥,åŽ»ä¸°å°ã€‚å¼€å§‹æˆ‘é€šè¿‡æ³•é™¢ç”µè¯å‘Šè¯‰æˆ‘åŽ»ä¸°å°åŒºäººæ°‘æ³•é™¢ä¸½æ³½æ³•åº­,æˆ‘å¸¦ç€ä»²è£ç»“æžœçš„ææ–™å…´é«˜é‡‡çƒˆçš„åˆ°è¿™åŽï¼Œä»–ä»¬å‘Šè¯‰æˆ‘ä¸åœ¨è¿™é‡Œï¼Œéœ€è¦åŽ»è¿‘å›­è·¯ç«‹æ¡ˆã€‚æˆ‘æ— è¯­äº†â€¦åæ­£ä¸¤ä¸ªåœ°æ–¹ä¸å¤ªè¿œ,ç›´æŽ¥åŽ»ä¸€è¶Ÿå§,åˆ°äº†åŽåœ¨æœåŠ¡å°ä¸Šé¢ä»–ä»¬å‘Šè¯‰æˆ‘å°‘äº†ä¸€ä¸ªæ–‡ä»¶â€”â€”è¢«æ‰§è¡Œäººçš„é€è¾¾å›žè¯ï¼Œè¦åŽ»ä»²è£é™¢é‚£ä¹ˆåŽ»è¦ã€‚çŽ°åœ¨åˆæ•´ç†ä¸€ä¸‹ç”³è¯·æ‰§è¡Œçš„ææ–™1. èº«ä»½è¯+å¤å°ä»¶ï¼›2. ç”³è¯·æ‰§è¡Œä¹¦ä¸€ä»½ï¼Œä¸‹è½½;3. æ³•å¾‹æ–‡ä¹¦ï¼Œå°±æ˜¯é‚£ä¸ªä»²è£ä¹¦ï¼›4. è‡ªå·±å’Œå…¬å¸çš„é€è¾¾å›žè¯ï¼Œè¿™ä¸ªå†ä»Žä»²è£é™¢è¦ï¼›5. å¦‚æžœä½ æœ‰å…¬å¸çš„è´¢äº§è¯æ®ï¼Œå¯ä»¥æä¾›ï¼›2018å¹´10æœˆ31æ—¥ï¼Œè”ç³»ä»²è£å‘˜è¦åŒæ–¹çš„é€è¾¾å›žè¯ã€‚çº¦å®šæ˜Žå¤©åŽ»å–ã€‚2018å¹´11æœˆ1æ—¥ï¼Œé¢†å›žæ¥åŒæ–¹çš„é€è¾¾å›žè¯ï¼Œç›´æŽ¥å†åŽ»æ³•é™¢ã€‚å«å·â€”â€”æŽ’é˜Ÿâ€”â€”åˆ°æˆ‘äº†â€”â€”é€’ä¸Šææ–™ã€‚çª—å£äººå‘˜è¯´ï¼šæˆ‘ç»™ä½ è¯´ä¸‹å“ˆï¼Œä½ è¿™ä¸ªè¿˜ä¸èƒ½ç”³è¯·æ‰§è¡Œï¼Œä½ çœ‹è¿™ä¸ªå…¬å‘Šä¸Šé¢å†™çš„æ˜¯60å¤©ä¹‹å†…è®©å…¬å¸æ¥é¢†è£å†³ä¹¦ï¼Œç„¶åŽè£å†³ä¹¦ä¸Šé¢å†™é¢†åˆ°è£å†³ä¹¦åŽä¸æœçš„è¯15å¤©ä¹‹å†…ç”³è¯·ä¸Šè¯‰ã€‚å¦‚æžœä¸ä¸Šè¯‰çš„è¯é™7å¤©ä¹‹å†…ä»˜é’±ã€‚è¿™ä¸€å…±ç®—ä¸‹æ¥å°±æ˜¯60+15+7=82å¤©ï¼Œå°±æ˜¯è¯´ä»Žå…¬å‘Šå¼€å§‹åŽ82å¤©æ‰å¯ä»¥æ¥ç”³è¯·ã€‚what the f**kã€‚å›žå®¶ï¼Œæˆ‘åœ¨ç­‰ä¸€åˆ†é’Ÿâ€¦ç¨åŽé™„å›¾]]></content>
  </entry>
  <entry>
    <title><![CDATA[ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«ï¼ˆäºŒï¼‰]]></title>
    <url>%2F2017%2F%E7%94%A8Objective-C%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%88%AC%E8%99%AB%EF%BC%88%E4%BA%8C%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ä¸Šæ¬¡å†™è¿‡çˆ¬è™«çš„åˆç¯‡ï¼Œæˆ‘ä»¬å·²ç»èƒ½çˆ¬åˆ°åŸºæœ¬çš„æ•°æ®äº†ã€‚ä½†æ˜¯ä¸€å¼ ç½‘é¡µçš„æ•°æ®æ˜¯æœ‰é™çš„ï¼Œä»Žæˆ‘ä»¬ä¸Šæ¬¡çš„ç¨‹åºæ¥çœ‹ï¼Œèƒ½æŠ“åˆ°çš„å›¾ç‰‡æ‰ä¸è¿‡åæ¥å¼ ã€‚å¾ˆæ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ æŽ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­å®Œå–„æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæ¥æ»¡è¶³è¿™ä¸ªéœ€æ±‚å§ã€‚ å¿…å¤‡å·¥å…· è”æŽ¥ç½‘ç»œçš„Mac, æµè§ˆå™¨ï¼ŒæŽ¨èç”¨Google Chrome, Xcodeå¼€å‘å·¥å…·, ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«(ä¸€) çš„æºç  å¿…å¤‡æŠ€èƒ½å»ºè®®çœ‹å®Œ ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«(ä¸€) ,æ˜Žç™½ä¸€äº›ç®€å•çš„çŸ¥è¯†,è™½ç„¶æˆ‘å†™çš„å¾ˆçƒ‚,ä½†ä¹Ÿä¸è‡³äºŽçœ‹è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ä¸€å¤´é›¾æ°´ã€‚ æœ¬ç¯‡ç›®æ ‡æ·±åº¦æŠ“å–æ›´å¤šçš„æ•°æ®å¦‚å›¾: åˆ†æžåœ¨ä¸Šç¯‡ä¸­ï¼Œæˆ‘ä»¬ç»™å®šä¸€ä¸ªurlæŠ“å–å®Œå›¾ç‰‡ä¹‹åŽç›´æŽ¥å°±ç»“æŸäº†ï¼Œé‚£ä¹ˆå¦‚ä½•ä¸è®©ç¨‹åºç»“æŸï¼Œè€Œç»§ç»­æŠ“å–åˆ«çš„urå‘¢ï¼Ÿæ€»ä¸èƒ½ç»™SpiderOptionå®šä¹‰ä¸€ä¸ªurlæ•°ç»„,ç¨‹åºçš„è¾“å…¥æ˜¯æœ‰é™çš„,è¿™ç§åŠžæ³•è§£å†³ä¸äº†é—®é¢˜ã€‚èªæ˜Žçš„ä½ ä¸€å®šæƒ³åˆ°äº†ï¼Œåœ¨çˆ¬è™«çˆ¬å–å›¾ç‰‡çš„æ—¶å€™ï¼Œä¸ä¹Ÿæ˜¯å¯ä»¥çˆ¬åˆ°è¿™ä¸ªé¡µé¢çš„è·³è½¬é¡µé¢ä¹ˆï¼Œå¦‚æžœæˆ‘ä»¬åœ¨æŠŠè·³è½¬é¡µé¢çš„å›¾ç‰‡çˆ¬ä¸‹æ¥ï¼Œç”šè‡³æŠŠè·³è½¬é¡µé¢é‡Œé¢çš„è·³è½¬é¡µé¢çˆ¬ä¸‹æ¥ï¼Œè¿™æ ·ä¸€ç›´å¾€æ·±å±‚æ¬¡çš„æŠ“å–æ•°æ®ï¼Œå°±ä¸æ˜¯æºæºä¸æ–­çš„å›¾ç‰‡çˆ¬åˆ°æ‰‹äº†ä¹ˆï¼ŸðŸ˜Žä¸‹é¢æˆ‘ä»¬å°±å¼€å§‹å§ï¼ï¼ï¼ ç¼–ç å‡†å¤‡é¦–å…ˆæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹Spiderç±»ï¼Œç»™Spideræ·»åŠ å‡ ä¸ªå˜é‡:1ã€_finashUrl ç”¨æ¥å­˜æ”¾å·²ç»çˆ¬å–è¿‡çš„url,é˜²æ­¢é‡å¤æŠ“å–,å¯¼è‡´é‡å¤å¾ªçŽ¯ã€‚2ã€_session ç”¨æ¥è¿›è¡ŒèŽ·å–htmlçš„ç½‘ç»œè¯·æ±‚;åœ¨ç¬¬ä¸€ç¯‡ä¸­æˆ‘ä»¬ç›´æŽ¥åœ¨æ–¹æ³•é‡Œé¢å®šä¹‰äº†ç›¸åŒçš„å˜é‡,è¿™é‡Œæˆ‘ä»¬æŠŠå®ƒå£°æ˜Žæˆå˜é‡,é˜²æ­¢é‡å¤åˆ›å»ºå¯¹è±¡.3ã€_urlExpression ç”¨æ¥åŒ¹é…urlçš„æ­£åˆ™è¡¨è¾¾å¼.4ã€_imgExpression ç”¨æ¥åŒ¹é…imgçš„æ­£åˆ™è¡¨è¾¾å¼.5ã€fetchHtmlQueue æ­£åˆ™åŒ¹é…çš„é˜Ÿåˆ—.6ã€operationQueue ç½‘ç»œè¯·æ±‚çš„é˜Ÿåˆ—. å®šä¹‰ä¸Šé¢å˜é‡ä¹‹åŽå¹¶ä¸”åœ¨initæ–¹æ³•ä¸­åˆå§‹åŒ–ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748@interface Spider()&lt;NSURLSessionDataDelegate&gt;@property (nonatomic, strong) NSOperationQueue* fetchHtmlQueue;@property (nonatomic, strong) NSOperationQueue* operationQueue;@end@implementation Spider&#123; //å·²ç»æŠ“å–çš„url NSMutableSet&lt;NSString*&gt;* _finashUrl; NSRegularExpression* _urlExpression; NSRegularExpression* _imgExpression; NSURLSession* _session;&#125;- (instancetype)initWithOption:(SpiderOption *)option&#123; self = [super init]; if (self) &#123; _option = option; _finashUrl = [NSMutableSet set]; _imgExpression = [NSRegularExpression regularExpressionWithPattern:option.pattern options:NSRegularExpressionCaseInsensitive error:nil]; _urlExpression = [NSRegularExpression regularExpressionWithPattern:@"https?:.+?.html" options:NSRegularExpressionCaseInsensitive error:nil]; _operationQueue = [[NSOperationQueue alloc] init]; _operationQueue.maxConcurrentOperationCount = 3; _operationQueue.name = @"com.html.loadQueue"; _fetchHtmlQueue = [[NSOperationQueue alloc] init]; _fetchHtmlQueue.maxConcurrentOperationCount = 3; _fetchHtmlQueue.name = @"com.html.fetchQueue"; NSURLSessionConfiguration* configuration = [NSURLSessionConfiguration defaultSessionConfiguration]; configuration.timeoutIntervalForRequest = 30; _session = [NSURLSession sessionWithConfiguration:configuration delegate:self delegateQueue:_fetchHtmlQueue]; &#125; return self;&#125; æ”¹å†™æ–¹æ³•ç”±äºŽæˆ‘ä»¬ç”¨äº†å¤šçº¿ç¨‹çš„æŠ€æœ¯ï¼Œæ¯æ¬¡åŠ è½½ä¸€ä¸ªurléƒ½è¦æ”¾åˆ°é˜Ÿåˆ—åŽ»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹ä¸€ä¸‹loadUrlæ–¹æ³•: 12345678910111213141516- (void)loadUrl:(NSURL*)url&#123; WeakSelf; @synchronized(self)&#123; [self-&gt;_operationQueue addOperationWithBlock:^&#123; StrongSelf; NSURLSessionDataTask* task = [sSelf-&gt;_session dataTaskWithURL:url]; [task resume]; &#125;]; &#125;&#125; ä¸Šä¸€æ­¥è¯·æ±‚æˆåŠŸä¹‹åŽï¼Œä¼šè°ƒç”¨sessionçš„ä»£ç†æ–¹æ³•ï¼Œæ‰€æœ‰æˆ‘ä»¬éœ€è¦å®žçŽ°sessionçš„ä»£ç†æ–¹æ³•: 1234567891011121314151617181920212223242526272829303132///MARK:- NSURLSessionDataDelegate- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTaskdidReceiveResponse:(NSURLResponse *)response completionHandler:(void (^)(NSURLSessionResponseDisposition))completionHandler&#123; NSURLSessionResponseDisposition disposition = NSURLSessionResponseCancel; NSInteger statusCode = 0; if ([response respondsToSelector:@selector(statusCode)])&#123; statusCode = [((NSHTTPURLResponse*)response) statusCode]; &#125; if (statusCode == 200) &#123; disposition = NSURLSessionResponseAllow; &#125; completionHandler(disposition);&#125;- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveData:(NSData *)data&#123; NSString* html = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; if (html &amp;&amp; html.length &gt; 0) &#123; [self fetchUrlWithHtml:html]; [self fetchImgWithHtml:html]; &#125;&#125; æˆ‘ä»¬åœ¨ä¿®æ”¹ä¸€ä¸‹fetchImgWithHtmlæ–¹æ³•,åŒ¹é…imgä¹Ÿè¦æ”¾åˆ°é˜Ÿåˆ—é‡Œ,åŒ¹é…æˆåŠŸåŽå›žè°ƒå³å¯: 12345678910- (void)fetchImgWithHtml:(NSString*)html&#123; WeakSelf; [self.fetchHtmlQueue addOperationWithBlock:^&#123; StrongSelf; NSArray&lt;NSString*&gt;* strings = [sSelf fetchStringsWithHtml:html expression:sSelf-&gt;_imgExpression]; sSelf.option.complete ? sSelf.option.complete(strings) : nil; &#125;];&#125; åŒç†æˆ‘ä»¬ä¿®æ”¹fetchUrlWithHtmlæ–¹æ³•,å¹¶ä¸”æŠŠéœ€è¦è¯·æ±‚çš„urlæ”¾åˆ°_finashUrlé‡Œé¢,åœ¨è¯·æ±‚ä¹‹å‰åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦è¯·æ±‚è¿‡å³å¯: 123456789101112131415161718- (void)fetchUrlWithHtml:(NSString*)html&#123; WeakSelf; [self.fetchHtmlQueue addOperationWithBlock:^&#123; StrongSelf; NSArray&lt;NSString*&gt;* strings = [sSelf fetchStringsWithHtml:html expression:sSelf-&gt;_urlExpression]; for (NSString* string in strings) &#123; NSURL* url = [NSURL URLWithString:string]; if ([sSelf-&gt;_finashUrl containsObject:string]) &#123; continue; &#125; [sSelf-&gt;_finashUrl addObject:string]; [sSelf loadUrl:url]; &#125; &#125;];&#125; æœ€åŽé™„ä¸ŠfetchStringsWithHtmlæ–¹æ³•: 12345678910111213141516- (NSArray&lt;NSString*&gt;*)fetchStringsWithHtml:(NSString*)html expression:(NSRegularExpression*)expression&#123; NSArray&lt;NSTextCheckingResult*&gt;* results = [expression matchesInString:html options:NSMatchingReportCompletion range:NSMakeRange(0, html.length)]; NSMutableArray&lt;NSString*&gt;* strings = [NSMutableArray arrayWithCapacity:results.count]; for (NSTextCheckingResult* result in results) &#123; NSString* sub = [html substringWithRange:result.range]; [strings addObject:sub]; &#125; return strings;&#125; è¿è¡ŒæŽ¥ä¸‹æ¥è¿è¡Œä¸€ä¸‹ç¨‹åºï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ç¨‹åºä¸åœçš„æŠ“å–å›¾ç‰‡ï¼Œè¶Šæ¥è¶Šå¤šã€‚ å¯è§†åŒ–ä¸ºäº†æ›´å¥½çš„æµè§ˆæˆ‘ä»¬èŽ·å–çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æŽ§åˆ¶å™¨é‡Œé¢ç”¨UICollectionViewå±•çŽ°å‡ºæ¥ï¼Œç›´æŽ¥ä¸Šä»£ç : 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788- (void)appendUrls:(NSArray&lt;NSString *&gt;*)urls&#123; if (urls.count &gt; 0) &#123; WeakSelf; dispatch_async(dispatch_get_main_queue(), ^&#123; [self.collectionView performBatchUpdates:^&#123; NSMutableArray&lt;NSIndexPath*&gt;* idxs = [NSMutableArray array]; for (int i = 0; i &lt; urls.count; i ++) &#123; NSIndexPath* idx = [NSIndexPath indexPathForItem:weakSelf.urls.count + i inSection:0]; [idxs addObject:idx]; &#125; [weakSelf.urls addObjectsFromArray:urls]; [weakSelf.collectionView insertItemsAtIndexPaths:idxs]; &#125; completion: NULL]; &#125;); &#125;&#125;- (void)viewDidLayoutSubviews&#123; [super viewDidLayoutSubviews]; self.collectionView.frame = self.view.bounds;&#125;- (NSInteger)collectionView:(UICollectionView *)collectionView numberOfItemsInSection:(NSInteger)section&#123; return self.urls.count;&#125;- (__kindof UICollectionViewCell*)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath&#123; CollectionViewCell* cell = [collectionView dequeueReusableCellWithReuseIdentifier:CollectionViewCellID forIndexPath:indexPath]; cell.url = self.urls[indexPath.row]; return cell;&#125;- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout minimumLineSpacingForSectionAtIndex:(NSInteger)section&#123; return 0.5;&#125;- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout minimumInteritemSpacingForSectionAtIndex:(NSInteger)section&#123; return 0.01;&#125;- (UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout insetForSectionAtIndex:(NSInteger)section&#123; return UIEdgeInsetsZero;&#125;- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath&#123; UICollectionViewFlowLayout* layout = (UICollectionViewFlowLayout*)collectionViewLayout; CGFloat w = (CGRectGetWidth(collectionView.frame) - layout.minimumInteritemSpacing - layout.sectionInset.left - layout.sectionInset.right) / 8 - 0.5; return CGSizeMake(w, w);&#125;- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath&#123; DetailController* detail = [[DetailController alloc] init]; detail.url = self.urls[indexPath.row]; [self.navigationController pushViewController:detail animated:YES];&#125;- (UICollectionView *)collectionView&#123; if (!_collectionView) &#123; UICollectionViewFlowLayout* layout = [[UICollectionViewFlowLayout alloc] init]; layout.minimumLineSpacing = 0.5; layout.minimumInteritemSpacing = 0; layout.sectionInset = UIEdgeInsetsZero; _collectionView = [[UICollectionView alloc] initWithFrame:CGRectZero collectionViewLayout:layout]; _collectionView.delegate = self; _collectionView.dataSource = self; [_collectionView registerClass:[CollectionViewCell class] forCellWithReuseIdentifier:CollectionViewCellID]; _collectionView.backgroundColor = [UIColor whiteColor]; &#125; return _collectionView;&#125; è‡³æ­¤ï¼Œæˆ‘ä»¬å°±ç®—å®Œæˆäº†æˆ‘ä»¬çš„ç›®æ ‡;çœ‹åˆ°ç¨‹åºä¸åœçš„æœ‰å›¾ç‰‡åŠ è½½å‡ºæ¥ï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹å°å…´å¥‹å‘¢ã€‚ðŸ˜„çŽ°åœ¨æˆ‘ä»¬å†™çš„ç¨‹åºä¼šæ— é™å¾ªçŽ¯çš„çˆ¬å–ï¼Œä½†æ˜¯æ€Žä¹ˆèƒ½æŽ§åˆ¶çˆ¬å–æ·±åº¦å‘¢ï¼Ÿ æŽ§åˆ¶æ·±åº¦æˆ‘çš„åšæ³•æ˜¯ç»™urlåˆ›å»ºä¸€ä¸ªåˆ†ç±»ï¼Œæ·»åŠ ä¸€ä¸ªå±žæ€§depthè¡¨ç¤ºæ­¤urlçš„æ·±åº¦å€¼,åˆå§‹çš„urlæ·±åº¦ä¸º0,åœ¨æ­¤é¡µé¢ä¸Šçˆ¬å–çš„urlæ·±åº¦ä¸º1ï¼Œè¿™æ ·ä»¥æ­¤ç±»æŽ¨ï¼Œç›´åˆ°æˆ‘ä»¬æŒ‡å®šæ·±åº¦åœæ­¢ä¸ºæ­¢ã€‚ NSURL+depth.h 12345@interface NSURL (depth)@property (nonatomic, assign) NSUInteger depth;@end NSURL+depth.m 1234567891011121314151617#import "NSURL+depth.h"#import &lt;objc/runtime.h&gt;static const void * depth_key = "depth_key";@implementation NSURL (depth)@dynamic depth;- (NSUInteger)depth&#123; return [objc_getAssociatedObject(self, depth_key) unsignedIntegerValue];&#125;- (void)setDepth:(NSUInteger)depth&#123; objc_setAssociatedObject(self, depth_key, @(depth), OBJC_ASSOCIATION_ASSIGN);&#125;@end ç„¶åŽåœ¨æˆ‘ä»¬çš„ startæ–¹æ³•é‡Œé¢ç»™ç¬¬ä¸€ä¸ªurlçš„æ·±åº¦èµ‹å€¼: 123456- (void)start&#123; NSURL* url = [NSURL URLWithString:self.option.website]; url.depth = 0; [self loadUrl:url];&#125; åœ¨sessionå›žè°ƒçš„æ–¹æ³•é‡Œé¢æˆ‘ä»¬åˆ¤æ–­ä¸€ä¸‹æ­¤urlçš„æ·±åº¦æ˜¯å¦éœ€è¦ç»§ç»­çˆ¬å–: 12345678910111213- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask didReceiveData:(NSData *)data&#123; NSString* html = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; NSUInteger depth = dataTask.originalRequest.URL.depth; if (html &amp;&amp; html.length &gt; 0) &#123; if (depth &lt; self.option.maxDepth) &#123; [self fetchUrlWithHtml:html depth:depth + 1]; &#125; [self fetchImgWithHtml:html]; &#125;&#125; ç„¶åŽæ”¹ä¸‹fetchUrlWithHtmlæ–¹æ³•ï¼Œç»™ä¸‹ä¸ªurlèµ‹å€¼æ·±åº¦: 12345678910111213141516171819202122232425262728- (void)fetchUrlWithHtml:(NSString*)html depth:(NSUInteger)depth&#123; WeakSelf; [self.fetchHtmlQueue addOperationWithBlock:^&#123; StrongSelf; NSArray&lt;NSString*&gt;* strings = [sSelf fetchStringsWithHtml:html expression:sSelf-&gt;_urlExpression]; for (NSString* string in strings) &#123; NSURL* url = [NSURL URLWithString:string]; if ([sSelf-&gt;_finashUrl containsObject:string]) &#123; continue; &#125; url.depth = depth; [sSelf-&gt;_finashUrl addObject:string]; [sSelf loadUrl:url]; &#125; &#125;];&#125;``` æœ€åŽå¿˜è¯´äº†ä¸€ä¸ªåœ°æ–¹,é‚£å°±æ˜¯`SpiderOption`,ç»™è¿™ä¸ªç±»æ·»åŠ ä¸€ä¸ªæœ€å¤§æ·±åº¦çš„å±žæ€§,è®©å¤–ç•Œæ¥æŽ§åˆ¶: ```objc /** æœ€å¤§æŠ“å–æ·±åº¦ é»˜è®¤ NSUIntegerMax */@property (nonatomic, assign) NSUInteger maxDepth; ok,åœ¨æŽ§åˆ¶å™¨é‡Œé¢ç»™å®šæœ€å¤§çš„æ·±åº¦,æœ€å¥½ä¸è¦å¤ªå¤§,è¿è¡Œä¸€ä¸‹å§ï¼ï¼ï¼ ç›¸å…³é“¾æŽ¥: é¡¹ç›®æºç  ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«(ä¸€)]]></content>
  </entry>
  <entry>
    <title><![CDATA[ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«ï¼ˆä¸€ï¼‰]]></title>
    <url>%2F2017%2F%E7%94%A8Objective-C%E5%86%99%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E7%88%AC%E8%99%AB%EF%BC%88%E4%B8%80%EF%BC%89%2F</url>
    <content type="text"><![CDATA[ä½ æ˜¯ä¸æ˜¯æƒ³å†™ä¸ªçˆ¬è™«æ¥æŠ“å–ç‚¹ä¸œè¥¿,ä½†æ˜¯ä½ åˆä¸ä¼šPythonæˆ–è€…åˆ«çš„è¯­è¨€ï¼Œé‚£ä¹ˆä½ å°±å¾—æ„Ÿè°¢ä½ è‡ªå·±èƒ½æ¥åˆ°è¿™é‡Œã€‚æŽ¥ä¸‹æ¥å°±äº¤ç»™ä½ å¦‚ä½•ç”¨Objective-Cå†™ä¸€ä¸ªçˆ¬è™«ã€‚ ä»€ä¹ˆï¼ŸObjective-Cä¹Ÿèƒ½å†™çˆ¬è™«ï¼Ÿä¸éƒ½æ˜¯Pythonæ‰å¯ä»¥çš„ä¹ˆï¼Ÿé‚£ä¹ˆæˆ‘å‘Šè¯‰ä½ åŸºæœ¬ä¸Šå¤§éƒ¨åˆ†è¯­è¨€éƒ½æ˜¯å¯ä»¥å†™çˆ¬è™«çš„ï¼Œåªæ˜¯Pythonç”¨æ¥å†™çˆ¬è™«æ¯”è¾ƒæ–¹ä¾¿ï¼Œä»–æœ‰æµ·é‡çš„ä¸‰æ–¹åº“å¯ä»¥è®©å¼€å‘è€…è°ƒç”¨è€Œå·²ã€‚è€Œåˆ«çš„è¯­è¨€åŸºæœ¬ä¸Šå°±æ˜¯é è‡ªå·±è‹¦é€¼çš„æ’¸äº†ã€‚ é‚£ä¹ˆç”¨Objective-Cå†™çˆ¬è™«æœ‰ä»€ä¹ˆç”¨ï¼Ÿé iPhoneæ¥çˆ¬æ•°æ®ä¹ˆï¼Ÿè¿™é‡Œåšä¸»åªæ˜¯å†™ä¸ªç®€å•çš„çˆ¬è™«è€Œå·²ï¼Œå¹¶ä¸æŒ‡æœ›ç”¨æ­¤æ¥ä¸“é—¨æŠ“å–æ•°æ®ï¼Œä½ è§‰å¾—è®©æ‰‹æœºåŽ»çˆ¬æ•°æ®èƒ½çˆ¬å¤šå°‘å•Šã€‚æœ¬æ•™ç¨‹ä¼šå…¼å®¹Macè½¯ä»¶å¼€å‘ï¼Œä½ å¯ä»¥ç”¨æ­¤æŠ€æœ¯å¼€å‘macçˆ¬è™«å·¥å…·ã€‚ åºŸè¯å°‘è¯´ï¼Œè®©æˆ‘ä»¬æ¥å¼€å§‹å§ï¼ å¿…å¤‡å·¥å…· é“¾æŽ¥ç½‘ç»œçš„Mac, æµè§ˆå™¨ï¼ŒæŽ¨èç”¨Google Chrome Xcodeå¼€å‘å·¥å…· å¿…å¤‡æŠ€èƒ½ ç†Ÿæ‚‰Objective-C èƒ½é˜…è¯»HTML,èƒ½è®¤è¯†åŸºæœ¬çš„æ ‡ç­¾å³å¯ æ­£åˆ™è¡¨è¾¾å¼,å¤§æ¦‚æµè§ˆä¸€ä¸‹å°±è¡Œ,è¿™é‡Œåœ¨é‡åˆ°çš„æ—¶å€™åšä¸»ä¼šç®€å•ä»‹ç»ä¸€ä¸‹ æœ¬ç¯‡ç›®æ ‡ æŠ“å–å›žè½¦æ¡Œé¢ä¸Šçš„å›¾ç‰‡ é™„å›¾: åˆ†æžç½‘é¡µç”¨æµè§ˆå™¨æ‰“å¼€å›žè½¦æ¡Œé¢,å¹¶ä¸”æŒ‰ä¸‹ option + command + iæ‰“å¼€å¼€å‘è€…å·¥å…·ã€‚å¦‚å›¾: ç¡®ä¿å³ä¸Šæ–¹æ˜¯é€‰ä¸­çš„Elementsé€‰é¡¹ï¼Œä¸‹é¢HTMLå°±æ˜¯ç½‘é¡µçš„æºä»£ç ã€‚é¼ æ ‡åœ¨HTMLä¸Šé¢ç§»åŠ¨çš„æ—¶å€™å·¦ä¾§é¡µé¢ä¼šæœ‰ç›¸åº”çš„æ¨¡å—æç¤ºï¼Œæˆ‘ä»¬ä»¥æ¬¡ç‚¹å¼€æ ‡ç­¾ï¼Œå°±èƒ½æ‰¾åˆ°æƒ³è¦çš„å›¾ç‰‡åœ°å€: å¦‚å›¾: ç²˜ä¸€æ®µä»£ç : 123456&lt;img a_width="576" a_height="360" src="https://up.enterdesk.com/edpic_360_360/cf/e1/8f/cfe18f5a7e0a42355784bb992f313853.jpg" alt="æ¸…æ˜ŽèŠ‚æ°”" title="æ¸…æ˜ŽèŠ‚æ°”" style="height: 185px; width: 296px;"&gt; ä¸Šæ®µä»£ç ä¸­srcå°±æ˜¯ç½‘é¡µä¸­çš„å›¾ç‰‡åœ°å€ï¼Œæˆ‘ä»¬æŽ¥ä¸‹æ¥å°±æ˜¯æŠŠè¿™ä¸ªsrcçš„å€¼æå–å‡ºæ¥ã€‚ ç¼–ç ä¸Šé¢æˆ‘ä»¬åˆ†æžäº†ç½‘é¡µæºç ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¤§è‡´æµç¨‹ï¼š èŽ·å–ç½‘é¡µæºç  æ­£åˆ™æå–url å¥½! è®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªObjective-Cé¡¹ç›®ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦æ˜¯æ¥ä»‹ç»å¦‚ä½•å†™çˆ¬è™«ï¼Œè‡³äºŽObjective-Cé¡¹ç›®è‡ªå·±åˆ›å»ºå³å¯ã€‚ åˆå§‹åŒ–åšä¸»è¿™é‡Œåœ¨ä¸»æŽ§åˆ¶å™¨ä¸Šé¢æ·»åŠ ä¸€ä¸ªUITextViewï¼ŒèƒŒæ™¯è‰²ä¸ºé»‘è‰²ï¼›Tint é¢œè‰²ä¸ºç»¿è‰²ï¼Œ(è¿™æ ·çš„é¢œè‰²çœ‹èµ·æ¥æ¯”è¾ƒé«˜å¤§ä¸Šä¸€ç‚¹)ï¼›ä¸å¯ç¼–è¾‘ï¼›æ‰“å¼€è¶…è¿žæŽ¥åŠŸèƒ½ï¼›å¹¶ä¸”è¿žæŽ¥åˆ°æ‰€åœ¨çš„æŽ§åˆ¶å™¨ã€‚å¦‚å›¾: åˆ›å»ºå·¥å…·ç±»åˆ›å»ºSpiderç±»å’ŒSpiderOptionç±»ã€‚Spideræ˜¯çˆ¬è™«å·¥å…·ç±»;SpiderOptionæ˜¯å‚æ•°ç±»ï¼Œåœ¨çˆ¬æ•°æ®è¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„å‚æ•°éƒ½ç”±SpiderOptionä¼ é€’ç»™Spider SpiderOption.h 12345678910111213141516171819202122#import &lt;Foundation/Foundation.h&gt;typedef void(^SpiderCompleteHander)(NSString* url);@interface SpiderOption : NSObject/** ç›®æ ‡ç½‘ç«™ */@property (nonatomic, copy) NSString* website;/** æŠ“å–æ•°æ®æ­£åˆ™è¡¨è¾¾å¼ */@property (nonatomic, copy) NSString* pattern;/** UrlæŠ“å–å®Œæˆå›žè°ƒ */@property (nonatomic, copy) SpiderCompleteHander progress;@end Spider.h 123456789101112131415161718192021222324#import &lt;Foundation/Foundation.h&gt;#import "SpiderOption.h"@interface Spider : NSObject/** å‚æ•°ç±» */@property (nonatomic, strong, readonly) SpiderOption* option;/** åˆå§‹åŒ–æ–¹æ³• @param option å‚æ•°ç±» @return self */- (instancetype)initWithOption:(SpiderOption*)option;/** å¼€å§‹æŠ“å– */- (void)start;@end Spider.m 1234567891011121314151617#import "Spider.h"@implementation Spider- (instancetype)initWithOption:(SpiderOption *)option&#123; self = [super init]; if (self) &#123; _option = option; &#125; return self;&#125;- (void)start&#123;&#125;@end æµ‹è¯•å·¥å…·ç±»ç»è¿‡ç¬¬äºŒæ­¥ä¹‹åŽï¼Œåˆæ­¥çš„çˆ¬è™«å·¥å…·å°±å¯ä»¥ä½¿ç”¨äº†ï¼Œä¸‹é¢æˆ‘ä»¬åœ¨ViewController.mé‡Œé¢è°ƒç”¨æˆ‘ä»¬çš„çˆ¬è™«å·¥å…·ã€‚ ViewController.m 123456789101112131415161718192021222324252627282930313233343536373839404142#import "ViewController.h"#import "Spider.h"@interface ViewController ()@property (weak, nonatomic) IBOutlet UITextView *textView;@property (strong, nonatomic) Spider *spider;@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; //åˆå§‹åŒ–ä¸€ä¸ªå‚æ•°ç±» SpiderOption* option = [[SpiderOption alloc] init]; //å‡†å¤‡ç›®æ ‡ç½‘å€ option.website = @"https://www.enterdesk.com"; //å¤„ç†å›žè°ƒï¼Œå½“æˆåŠŸæŠ“å–ä¸€ä¸ªå†…å®¹ä¹‹åŽï¼Œæˆ‘ä»¬å°±æŠŠä»–æ‹¼æŽ¥åˆ°textViewçš„åº•éƒ¨ option.complete = ^(NSString *url) &#123; [self showLogs:url]; &#125;; //åˆå§‹åŒ–çˆ¬è™«ç±» self.spider = [[Spider alloc] initWithOption:option]; //å¼€å§‹æŠ“å– [self.spider start];&#125;- (void)showLogs:(NSString*)log&#123; //æŠŠLogå†…å®¹æ‹¼æŽ¥åˆ°textViewæœ€ä¸‹é¢ï¼Œå¹¶ä¸”æ»šåŠ¨åˆ°æœ€ä¸‹é¢ if (log.length &gt; 0) &#123; [self.textView insertText:[NSString stringWithFormat:@"%@\n\n",log]]; [self.textView scrollRangeToVisible:NSMakeRange(self.textView.text.length, 0)]; &#125;&#125;@end çŽ°åœ¨æ¥è¿è¡Œä¸€ä¸‹æˆ‘ä»¬çš„é¡¹ç›®ï¼Œè™½ç„¶ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¼€å§‹çˆ¬ä»€ä¹ˆæ•°æ®ï¼ŒæŽ¥ä¸‹è®©æˆ‘ä»¬æ¥å®Œå–„æˆ‘ä»¬çš„Spiderå·¥å…·ç±»ã€‚ å®Œå–„å·¥å…·ç±»åœ¨æˆ‘ä»¬çš„Spider.mé‡Œé¢æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œæ¥èŽ·å–ç½‘é¡µçš„HTMLæºç ï¼š 12345678910111213141516171819- (void)loadUrl:(NSString*)urlString&#123; WeakSelf; urlString = [urlString stringByAddingPercentEncodingWithAllowedCharacters:[NSCharacterSet URLQueryAllowedCharacterSet]]; NSURL* url = [NSURL URLWithString:urlString]; NSURLSessionConfiguration* configuration = [NSURLSessionConfiguration defaultSessionConfiguration]; NSURLSession* session = [NSURLSession sessionWithConfiguration:configuration]; NSURLSessionDataTask* task = [session dataTaskWithURL:url completionHandler:^(NSData * _Nullable data, NSURLResponse * _Nullable response, NSError * _Nullable error) &#123; if (!error) &#123; NSString* html = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; NSLog(@"%@",html); &#125; &#125;]; [task resume];&#125; æŽ¥ä¸‹æ¥åœ¨æˆ‘ä»¬çš„startæ–¹æ³•è°ƒç”¨ä¸Šè¿°æ–¹æ³•: 123- (void)start&#123; [self loadUrl:self.option.website];&#125; è®©æˆ‘ä»¬åœ¨è¿è¡Œä¸€æ¬¡é¡¹ç›®ï¼Œå¦‚æžœç½‘ç»œæ²¡æœ‰é—®é¢˜çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°æŽ§åˆ¶å™¨ä¸Šé¢è¾“å‡ºçš„HTMLæºç ,å°½ç®¡æˆ‘ä»¬çš„textViewè¿˜æ˜¯é»‘é»‘çš„ä¸€ç‰‡ã€‚å¦‚ä¸‹å›¾: æ­£åˆ™åŒ¹é…æˆ‘ä»¬å†æ¬¡ç»™Spider.mæ·»åŠ ä¸€ä¸ªæ–¹æ³•,è¿™ä¸ªæ–¹æ³•ä¸»è¦å°±æ˜¯ä»ŽHTMLé‡Œé¢æå–å‡ºæˆ‘ä»¬æƒ³è¦çš„å†…å®¹ï¼Œæ¯”å¦‚æˆ‘ä»¬çš„å›¾ç‰‡,ç„¶åŽå›žè°ƒç»™æŽ§åˆ¶å™¨: 123456789101112131415161718192021- (void)matchesStringInHtml:(NSString*)html&#123; WeakSelf; NSRegularExpression* expression = [NSRegularExpression regularExpressionWithPattern:self.option.pattern options:NSRegularExpressionCaseInsensitive error:nil]; NSArray&lt;NSTextCheckingResult*&gt;* results = [expression matchesInString:html options:NSMatchingReportCompletion range:NSMakeRange(0, html.length)]; NSMutableArray&lt;NSString*&gt;* strings = [NSMutableArray arrayWithCapacity:results.count]; for (NSTextCheckingResult* result in results) &#123; NSString* sub = [html substringWithRange:result.range]; [strings addObject:sub]; &#125; weakSelf.option.progress ? weakSelf.option.progress(strings) : nil;&#125; æ–¹æ³•å†™å¥½äº†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨loadUrlçš„completionHandlerè°ƒç”¨ä¸€ä¸‹. 123456789 Â·Â·Â· NSString* html = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; if (!error &amp;&amp; html.length &gt; 0) &#123; [sSelf fetchImgWithHtml:html]; &#125;else&#123; NSLog(@"åŠ è½½å‡ºé”™:%@",error); &#125; Â·Â·Â· è¿˜éœ€è¦ç»™SpiderOptionçš„patternèµ‹å€¼ï¼Œé‚£æˆ‘ä»¬åœ¨ViewController.mé‡Œé¢æ·»åŠ ä»¥ä¸‹æ­£åˆ™å³å¯ï¼š 123456...option.website = @"https://www.enterdesk.com";option.pattern = @"(?&lt;=(src=\"))https?://.+?.(jpg|png)";... æœ€åŽï¼Œè®©æˆ‘ä»¬è¿è¡Œä»¥ä¸‹çœ‹æ•ˆæžœå§,æ˜¯ä¸æ˜¯å¾ˆç®€å•å‘€ï¼ï¼ï¼ å¤‡æ³¨æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹æ­£åˆ™(?&lt;=(src=\&quot;))https?://.+?.(jpg|png)è¡¨è¾¾å¼çš„å«ä¹‰: HTMLä¸­çš„å›¾ç‰‡åœ°å€å¯èƒ½ç±»ä¼¼äºŽhttp://aaa.jpgã€åˆæˆ–è€…æ˜¯ä»¥httpså¼€å¤´çš„https://aaa.jpg,é‚£æˆ‘ä»¬å°±ç”¨https?://aaa.jpgå³å¯åŒ¹é…httpä¹Ÿå¯åŒ¹é…httpsã€‚?åœ¨è¿™é‡Œè¡¨ç¤ºå‰ä¸€ä¸ªå­—ç¬¦sæœ‰0ä¸ªæˆ–è€…1ä¸ªã€‚ æˆ–è®¸ç½‘é¡µä¸­çš„å›¾ç‰‡ä¸ä»…ä»…æ˜¯.jpgåˆæˆ–è€…æ˜¯.pngã€.gifç­‰ç­‰ï¼Œæˆ‘ä»¬ç”¨æˆ–|æå–æˆ‘ä»¬æƒ³è¦çš„æ ¼å¼å›¾ç‰‡ã€‚æ¯”å¦‚.(jpg|png)å°±æ˜¯æˆ‘ä»¬æƒ³å–jpgæˆ–è€…æ˜¯pngçš„å›¾ç‰‡,å¦‚æžœä½ ä¹Ÿæƒ³æå–.gifçš„å›¾ç‰‡ï¼Œå¯ä»¥è¿™æ ·å†™.(jpg|png|gif)å³å¯ã€‚ æˆ‘ä»¬å†è¯´è¯´ä¸­é—´çš„.+?,.ä»£è¡¨å•ä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼è¿™æ ·å†™http://..jpgæˆ‘ä»¬åªèƒ½æå–http://a.jpgè¿™ä¸­é—´åªæœ‰å•ä¸ªå­—ç¬¦çš„urlã€‚é‚£å¦‚æžœæˆ‘ä»¬æƒ³æå–ä¸­é—´ä¸ªæ•°ä¸ç¡®å®šçš„å‘¢ï¼Ÿæ¯”å¦‚http://abc.jpg?æˆ‘ä»¬å°±åœ¨.åŽé¢åŠ ä¸ª+å³å¯ï¼›+è¡¨ç¤ºå¤§äºŽç­‰äºŽ1ä¸ªï¼Œæ¯”å¦‚http://.+.jpgæˆ‘ä»¬æ—¢å¯ä»¥åŒ¹é…åˆ°http://a.jpgä¹Ÿå¯åŒ¹é…åˆ°http://aaa.jpgç­‰ä¸­é—´å¤šä¸ªå­—ç¬¦çš„urlã€‚ é‚£ä¹ˆåŽé¢çš„?å‘¢,è¿™é‡Œçš„?å¤šä»£è¡¨çš„æ˜¯éžè´ªå©ªåŒ¹é…ï¼Œä¸¾ä¸ªä¾‹å­:http://aa.jpg.jpgåƒè¿™ç§urlæˆ‘ä»¬è¯¥æ€Žä¹ˆæå–å‘¢ï¼Œå¦‚æžœæŒ‰ç…§åˆšæ‰http://.+.jpgçš„è¡¨è¾¾å¼åŒ¹é…å‡ºæ¥çš„æ˜¯http://aa.jpg.jpgæ•´ä¸ªä¸²ï¼Œä½†æ˜¯æˆ‘ä»¬åªæƒ³æå–åˆ°http://aa.jpgæ€Žä¹ˆåŠžï¼Œæˆ‘ä»¬å°±åœ¨+åŽé¢åŠ ä¸ª?ä»£è¡¨å°½å¯èƒ½å°‘çš„åŒ¹é…ï¼Œå°±æ˜¯æ‰€è°“çš„éžè´ªå©ªåŒ¹é…ã€‚ æœ€åŽåœ¨è¯´ä¸€ä¸‹(?&lt;=(src=\&quot;))è¿™ä¸ªæ„æ€å°±æ˜¯æˆ‘ä»¬è¦æå–src=&quot;åŽé¢çš„http:xx.jpgçš„å›¾ç‰‡ï¼Œä½†æ˜¯ä¸åŒ…å«src=&quot;ã€‚ä¸¾ä¸ªðŸŒ°:å¦‚æžœæŠŠè¿™ä¸ªè¡¨è¾¾å¼åŽ»æŽ‰ï¼Œæˆ‘ä»¬ä¼šå‘çŽ°æå–åˆ°çš„urlæœ‰å¯èƒ½æ˜¯è¿™æ ·https://www.enterdesk.com/bizhi/5488.html\&quot;&gt;&lt;img src=\&quot;https://up.enterdesk.com/edpic_360_360/34/3f/f4/343ff4ada1548da0a81388f86dd9d1af.jpgï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æžœã€‚æ‰€ä»¥è¯´è¿™ä¸ªå°±æ˜¯èµ·åˆ°äº†ç›¸åº”çš„ä½œç”¨ã€‚ ç›¸å…³é“¾æŽ¥: é¡¹ç›®æºç  ç”¨Objective-Cå†™ä¸€ä¸ªç®€å•çš„çˆ¬è™«(äºŒ)]]></content>
  </entry>
  <entry>
    <title><![CDATA[æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢]]></title>
    <url>%2F2017%2F%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2%2F</url>
    <content type="text"><![CDATA[æ˜¥æ±ŸèŠ±æœˆå¤œ ã€ä½œè€…ã€‘å¼ è‹¥è™š ã€æœä»£ã€‘å” è¯‘æ–‡å¯¹ç…§ æ˜¥æ±Ÿæ½®æ°´è¿žæµ·å¹³ï¼Œæµ·ä¸Šæ˜Žæœˆå…±æ½®ç”Ÿã€‚æ»Ÿæ»Ÿéšæ³¢åƒä¸‡é‡Œï¼Œä½•å¤„æ˜¥æ±Ÿæ— æœˆæ˜Žï¼ æ±Ÿæµå®›è½¬ç»•èŠ³ç”¸ï¼Œæœˆç…§èŠ±æž—çš†ä¼¼éœ°ï¼›ç©ºé‡Œæµéœœä¸è§‰é£žï¼Œæ±€ä¸Šç™½æ²™çœ‹ä¸è§ã€‚ æ±Ÿå¤©ä¸€è‰²æ— çº¤å°˜ï¼ŒçšŽçšŽç©ºä¸­å­¤æœˆè½®ã€‚æ±Ÿç•”ä½•äººåˆè§æœˆï¼Ÿæ±Ÿæœˆä½•å¹´åˆç…§äººï¼Ÿ äººç”Ÿä»£ä»£æ— ç©·å·²ï¼Œæ±Ÿæœˆå¹´å¹´åªç›¸ä¼¼ã€‚ä¸çŸ¥æ±Ÿæœˆå¾…ä½•äººï¼Œä½†è§é•¿æ±Ÿé€æµæ°´ã€‚ ç™½äº‘ä¸€ç‰‡åŽ»æ‚ æ‚ ï¼Œé’æž«æµ¦ä¸Šä¸èƒœæ„ã€‚è°å®¶ä»Šå¤œæ‰èˆŸå­ï¼Ÿä½•å¤„ç›¸æ€æ˜Žæœˆæ¥¼ï¼Ÿ å¯æ€œæ¥¼ä¸Šæœˆå¾˜å¾Šï¼Œåº”ç…§ç¦»äººå¦†é•œå°ã€‚çŽ‰æˆ·å¸˜ä¸­å·ä¸åŽ»ï¼Œæ£è¡£ç §ä¸Šæ‹‚è¿˜æ¥ã€‚ æ­¤æ—¶ç›¸æœ›ä¸ç›¸é—»ï¼Œæ„¿é€æœˆåŽæµç…§å›ã€‚é¸¿é›é•¿é£žå…‰ä¸åº¦ï¼Œé±¼é¾™æ½œè·ƒæ°´æˆæ–‡ã€‚ æ˜¨å¤œé—²æ½­æ¢¦è½èŠ±ï¼Œå¯æ€œæ˜¥åŠä¸è¿˜å®¶ã€‚æ±Ÿæ°´æµæ˜¥åŽ»æ¬²å°½ï¼Œæ±Ÿæ½­è½æœˆå¤è¥¿æ–œã€‚ æ–œæœˆæ²‰æ²‰è—æµ·é›¾ï¼Œç¢£çŸ³æ½‡æ¹˜æ— é™è·¯ã€‚ä¸çŸ¥ä¹˜æœˆå‡ äººå½’ï¼Œè½æœˆæ‘‡æƒ…æ»¡æ±Ÿæ ‘ã€‚ 12345@interface Dog- (void)viewDidLoad()&#123; NSLog(@"Hello world");&#125;@end 12345class Dog&#123; public static void main(String[] args)&#123; System.out.println("Hello world"); &#125;&#125; ä»…æ­¤çºªå¿µéƒ¨ç½²çš„ç¬¬ä¸€ä¸ªåšå®¢ï¼Œ ç‰¹åˆ«æ„Ÿè°¢:Devin_ tag { color:#999999 } author { font-size:14px }]]></content>
  </entry>
</search>
